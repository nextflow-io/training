// Nextflow configuration for Groovy Essentials side quest

docker.enabled = true

workflow.onStart = {
    println "Starting ${workflow.runName} at ${workflow.start}"
}

workflow.onError = {
    println "Workflow failed: ${workflow.errorMessage}"
}

workflow.onComplete = {
    def duration_mins = workflow.duration.toMinutes().round(2)
    def status = workflow.success ? "SUCCESS ✅" : "FAILED ❌"

    def summary = """
    Pipeline Execution Summary
    ===========================
    Completed: ${workflow.complete}
    Duration : ${workflow.duration}
    Success  : ${workflow.success}
    Command  : ${workflow.commandLine}
    """

    println summary

    // Write to a log file
    def log_file = file("${workflow.launchDir}/pipeline_summary.txt")
    log_file.text = summary

    println """
    Pipeline finished: ${status}
    Duration: ${duration_mins} minutes
    """
}
