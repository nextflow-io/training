/*
 * Nextflow Configuration
 *
 * This file demonstrates the separation of LOGIC from INFRASTRUCTURE.
 * The workflow (main.nf) describes WHAT to do.
 * This config describes HOW and WHERE to do it.
 *
 * Same workflow code runs on laptop, cluster, or cloud - just change the profile.
 */

// Default parameters
params {
    samples = '../data/samples.csv'
    outdir = '../results'
}

// Process defaults
process {
    cpus = 2
    memory = '4.GB'
    time = '2.h'
}

// Automatic report generation - provenance tracking built-in!
timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
}

// Execution profiles - same workflow, different infrastructure
profiles {

    // Local execution with Docker (default)
    standard {
        process.executor = 'local'
        docker.enabled = false  // Using mock processes for demo
    }

    // Local execution with real containers
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
    }

    // HPC cluster with SLURM scheduler
    slurm {
        process.executor = 'slurm'
        process.queue = 'general'
        process.clusterOptions = '--account=myproject'
        singularity.enabled = true
        singularity.cacheDir = '/shared/containers'
        docker.enabled = false
    }

    // HPC cluster with PBS scheduler
    pbs {
        process.executor = 'pbs'
        process.queue = 'batch'
        singularity.enabled = true
        docker.enabled = false
    }

    // AWS cloud execution
    aws {
        process.executor = 'awsbatch'
        process.queue = 'genomics-queue'
        workDir = 's3://my-bucket/work'
        aws.region = 'us-east-1'
        aws.batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
    }

    // Google Cloud execution
    gcp {
        process.executor = 'google-lifesciences'
        google.location = 'us-central1'
        google.region = 'us-central1'
        google.project = 'my-project'
        workDir = 'gs://my-bucket/work'
    }

    // Minimal resources for testing
    test {
        params.samples = '../data/samples.csv'
        process.cpus = 1
        process.memory = '2.GB'
    }
}
