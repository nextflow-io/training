
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://training.nextflow.io/0.dev/pt/side_quests/essential_scripting_patterns/">
      
      
        <link rel="prev" href="../debugging/">
      
      
        <link rel="next" href="../nf-test/">
      
      
        
          <link rel="alternate" href="../../../side_quests/essential_scripting_patterns/" hreflang="en">
        
          <link rel="alternate" href="./" hreflang="pt">
        
          <link rel="alternate" href="../../../es/side_quests/essential_scripting_patterns/" hreflang="es">
        
          <link rel="alternate" href="../../../fr/side_quests/essential_scripting_patterns/" hreflang="fr">
        
          <link rel="alternate" href="../../../it/side_quests/essential_scripting_patterns/" hreflang="it">
        
          <link rel="alternate" href="../../../ko/side_quests/essential_scripting_patterns/" hreflang="ko">
        
      
      
      <link rel="icon" href="../../../assets/img/nextflow-icon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Essential Nextflow Scripting Patterns - training.nextflow.io</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/fonts.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-244N3GEN75"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-244N3GEN75",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-244N3GEN75",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#essential-nextflow-scripting-patterns" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<div style="text-align: center">
  Nextflow Training Week (2025-Q1):
  <strong>March 10-14, 2025</strong>
  <a
    class="md-button"
    href="https://community.seqera.io/t/nextflow-training-week-2025-q1/1775/6"
    target="_blank"
  >
    More info
    <span class="twemoji"
      ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"
        ></path></svg
    ></span>
  </a>
</div>
<style type="text/css">
  .md-banner {
    display: none;
  }
</style>

<script>
  (function () {
    function hideAnnouncement() {
      var announcementDate = new Date(
        "2025-03-15T00:00:00Z",
      );
      var currentDate = new Date();
      var banner = document.querySelector(".md-banner");
      if (banner && currentDate <= announcementDate) {
        banner.style.display = "block";
      }
    }

    // Run on initial load
    hideAnnouncement();

    // Hook into XHR to run after each page update
    var originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function () {
      this.addEventListener("load", function () {
        setTimeout(hideAnnouncement, 0); // Ensure it runs after the request completes
      });
      return originalOpen.apply(this, arguments);
    };
  })();
</script>
 
          </div>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href="../../" title="training.nextflow.io" class="md-header__button md-logo" aria-label="training.nextflow.io" data-md-component="logo">
      
  <img src="../../../assets/img/nextflow_logo_dark.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            training.nextflow.io
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Essential Nextflow Scripting Patterns
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Selecione o idioma">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../side_quests/essential_scripting_patterns/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="pt" class="md-select__link">
              Português
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../es/side_quests/essential_scripting_patterns/" hreflang="es" class="md-select__link">
              Español
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../fr/side_quests/essential_scripting_patterns/" hreflang="fr" class="md-select__link">
              Français
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../it/side_quests/essential_scripting_patterns/" hreflang="it" class="md-select__link">
              Italiano
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../ko/side_quests/essential_scripting_patterns/" hreflang="ko" class="md-select__link">
              Korean
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Compartilhar" aria-label="Compartilhar" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Limpar" aria-label="Limpar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando a pesquisa
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/nextflow-io/training" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nextflow-io/training
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="training.nextflow.io" class="md-nav__button md-logo" aria-label="training.nextflow.io" data-md-component="logo">
      
  <img src="../../../assets/img/nextflow_logo_dark.png" alt="logo">

    </a>
    training.nextflow.io
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nextflow-io/training" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nextflow-io/training
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Environment setup
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Environment setup
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../envsetup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuração do ambiente
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../envsetup/01_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gitpod
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../envsetup/02_local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Instalação local
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../envsetup/03_devcontainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local installation using VSCode Devcontainers extension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nextflow Run
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nextflow Run
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nextflow_run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nextflow Run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nextflow_run/00_orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nextflow_run/01_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 1: Run basic operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nextflow_run/02_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 2: Run pipelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nextflow_run/03_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 3: Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Hello Nextflow
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Hello Nextflow
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hello Nextflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/00_orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientação
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/01_hello_world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 1: Hello World
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/02_hello_channels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 2: Hello Channels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/03_hello_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 3: Hello Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/04_hello_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 4: Hello Modules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/05_hello_containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 5: Hello Containers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/06_hello_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 6: Hello Config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/survey/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feedback survey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nextflow/next_steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Next Steps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Hello nf-core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Hello nf-core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hello nf-core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/00_orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/01_run_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 1: Run a demo pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/02_rewrite_hello/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 2: Rewrite Hello for nf-core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/03_use_module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 3: Use an nf-core module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/04_make_module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 4: Make an nf-core module
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/05_input_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 5: Input validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/survey/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feedback survey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hello_nf-core/next_steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Next Steps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nextflow for Science
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nextflow for Science
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nextflow for Science
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Genomics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Genomics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nextflow for Genomics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/00_orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/01_per_sample_variant_calling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 1: Per-sample variant calling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/02_joint_calling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 2: Joint calling on a cohort
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/03_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 3: Moving code into modules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/04_testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 4: Adding tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/survey/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feedback survey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/genomics/next_steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Next Steps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RNAseq
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    RNAseq
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/rnaseq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nextflow for RNAseq
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/rnaseq/00_orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/rnaseq/01_method/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 1: Method overview and manual testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/rnaseq/02_single-sample/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 2: Single-sample implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/rnaseq/03_multi-sample/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 3: Multi-sample paired-end implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/rnaseq/survey/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feedback survey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/rnaseq/next_steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Next Steps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Imaging
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Imaging
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nextflow run for Imaging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/00_orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/01_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 1: Run basic operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/02_run_molkart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 2: Run nf-core/molkart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/03_inputs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 3: Organizing inputs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/04_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part 4: Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/survey/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Survey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nf4_science/imaging/next_steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Next steps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Training Collections
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Training Collections
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../training_collections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Training Collections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../training_collections/architects_toolkit_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Architect's Toolkit I
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Side Quests
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Side Quests
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Side Quests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dev_environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metadata in workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../working_with_files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File input processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../splitting_and_grouping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Splitting and Grouping
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflows_of_workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflows of Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Essential Nextflow Scripting Patterns
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Essential Nextflow Scripting Patterns
  

    
  </span>
  
  

      </a>
      
          

<nav class="md-nav md-nav--secondary" aria-label="On this page">
       
  <label class="md-nav__title" for="__toc">
    <span class="md-nav__icon md-icon"></span>
    On this page
  </label>
  <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
     <li class="md-nav__item">
  <a href="#learning-goals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Learning goals
      
    </span>
  </a>
  
</li>  <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>  <li class="md-nav__item">
  <a href="#0-get-started" class="md-nav__link">
    <span class="md-ellipsis">
      
        0. Get started
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="0. Get started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open-the-training-codespace" class="md-nav__link">
    <span class="md-ellipsis">
      
        Open the training codespace
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-into-the-project-directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Move into the project directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#review-the-materials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Review the materials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readiness-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Readiness checklist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#1-dataflow-vs-scripting-understanding-the-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Dataflow vs Scripting: Understanding the Boundaries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Dataflow vs Scripting: Understanding the Boundaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-identifying-whats-what" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1. Identifying What's What
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1. Identifying What&#39;s What">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-basic-nextflow-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.1. Basic Nextflow Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-adding-the-map-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.2. Adding the Map Operator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-creating-a-map-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.3. Creating a Map Data Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-adding-conditional-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.4. Adding Conditional Logic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-subsetting-maps-with-submap" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.5. Subsetting Maps with .subMap()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116-combining-maps-and-returning-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.6. Combining Maps and Returning Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-understanding-different-types-channel-vs-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2. Understanding Different Types: Channel vs List
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-the-spread-operator-shorthand-for-property-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3. The Spread Operator (*.) - Shorthand for Property Extraction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#2-string-processing-and-dynamic-script-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. String Processing and Dynamic Script Generation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. String Processing and Dynamic Script Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-pattern-matching-and-regular-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1. Pattern Matching and Regular Expressions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dynamic-script-generation-in-processes" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2. Dynamic Script Generation in Processes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-variable-interpolation-nextflow-and-shell-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3. Variable Interpolation: Nextflow and Shell Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#3-creating-reusable-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Creating Reusable Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creating Reusable Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#takeaway_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#4-dynamic-resource-directives-with-closures" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Dynamic Resource Directives with Closures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Dynamic Resource Directives with Closures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#takeaway_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#5-conditional-logic-and-process-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Conditional Logic and Process Control
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Conditional Logic and Process Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-routing-with-branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Routing with .branch()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-using-filter-with-truthiness" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Using .filter() with Truthiness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#6-safe-navigation-and-elvis-operators" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Safe Navigation and Elvis Operators
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Safe Navigation and Elvis Operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-the-problem-accessing-properties-that-dont-exist" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1. The Problem: Accessing Properties That Don't Exist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-safe-navigation-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2. Safe Navigation Operator (?.)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-elvis-operator-for-defaults" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3. Elvis Operator (?:) for Defaults
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#7-validation-with-error-and-logwarn" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Validation with error() and log.warn
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Validation with error() and log.warn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#takeaway_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#8-workflow-event-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Workflow Event Handlers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Workflow Event Handlers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-the-oncomplete-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1. The onComplete Handler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-the-onerror-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2. The onError Handler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional resources
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      
        What's next?
      
    </span>
  </a>
  
</li> 
  </ul>
  
</nav>
<nav class="md-nav md-nav--secondary sidebar_resources" aria-label="Resources">
  <label class="md-nav__title">Resources</label>
  <ul class="md-nav__list">
    <li class="md-nav__item">
      <a
        href="https://nextflow.io/docs/latest/index.html"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M17.5 14.33c.79 0 1.63.08 2.5.24v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.33-4.5.99v-1.69c1.17-.53 2.67-.8 4.5-.8M13 12.46c1.29-.53 2.79-.79 4.5-.79.79 0 1.63.07 2.5.23v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.34-4.5.99m4.5-3.65c-1.9 0-3.39.32-4.5 1V9.84c1.23-.56 2.73-.84 4.5-.84.79 0 1.63.08 2.5.23v1.55c-.74-.19-1.59-.28-2.5-.28m3.5 8V7c-1.04-.33-2.21-.5-3.5-.5-2.05 0-3.88.5-5.5 1.5v11.5c1.62-1 3.45-1.5 5.5-1.5 1.19 0 2.36.16 3.5.5m-3.5-14c2.35 0 4.19.5 5.5 1.5v14.56c0 .12-.05.24-.16.35-.11.09-.23.17-.34.17-.11 0-.19-.02-.25-.05-1.28-.69-2.87-1.03-4.75-1.03-2.05 0-3.88.5-5.5 1.5-1.34-1-3.17-1.5-5.5-1.5-1.66 0-3.25.36-4.75 1.07-.03.01-.07.01-.12.03-.04.01-.08.02-.13.02-.11 0-.23-.04-.34-.12a.475.475 0 0 1-.16-.35V6c1.34-1 3.18-1.5 5.5-1.5 2.33 0 4.16.5 5.5 1.5 1.34-1 3.17-1.5 5.5-1.5Z"
          ></path>
        </svg>
        Nextflow Docs
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://www.nextflow.io/slack-invite.html"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M6 15a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2h2v2m1 0a2 2 0 0 1 2-2 2 2 0 0 1 2 2v5a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-5m2-8a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2v2H9m0 1a2 2 0 0 1 2 2 2 2 0 0 1-2 2H4a2 2 0 0 1-2-2 2 2 0 0 1 2-2h5m8 2a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2h-2v-2m-1 0a2 2 0 0 1-2 2 2 2 0 0 1-2-2V5a2 2 0 0 1 2-2 2 2 0 0 1 2 2v5m-2 8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2v-2h2m0-1a2 2 0 0 1-2-2 2 2 0 0 1 2-2h5a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-5Z"
          ></path>
        </svg>
        Nextflow Slack
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://nextflow.io/"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="80 50 350 350"
        >
          <style type="text/css">
            .st0 {
              fill: "gray";
            }
          </style>
          <path
            class="st0"
            d="M124.5,171.5c39.4,2.6,71.1,34.3,73.5,73.8h46.1c-2.6-65-54.7-117.2-119.6-119.9V171.5z"
          />
          <path
            class="st0"
            d="M198.3,255.8c-2.6,39.5-34.3,71.1-73.8,73.5v46.1c65-2.6,117.2-54.7,119.9-119.6H198.3z"
          />
          <path
            class="st0"
            d="M300.7,245c2.6-39.5,34.3-71.1,73.8-73.5v-46.1c-65,2.6-117.2,54.7-119.9,119.6H300.7z"
          />
          <path
            class="st0"
            d="M374.5,329.3c-39.4-2.6-71.1-34.3-73.5-73.8h-46.1c2.6,65,54.7,117.2,119.6,119.9V329.3z"
          />
        </svg>
        Nextflow Homepage
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://seqera.io/"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <?xml version="1.0" encoding="utf-8"?>
        <!-- Generator: Adobe Illustrator 28.3.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
        <svg
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          viewBox="80 50 350 350"
          style="enable-background: new 0 0 500 500"
          xml:space="preserve"
        >
          <style type="text/css">
            .st0 {
              clip-path: url(#SVGID_00000006699037935518914080000000086571810102047141_);
            }
            .st1 {
              fill: "gray";
            }
          </style>
          <g>
            <defs>
              <rect id="SVGID_1_" x="125" y="125" width="250" height="250" />
            </defs>
            <clipPath
              id="SVGID_00000183214694142566821210000012389151436317298101_"
            >
              <use xlink:href="#SVGID_1_" style="overflow: visible" />
            </clipPath>
            <g
              style="
                clip-path: url(#SVGID_00000183214694142566821210000012389151436317298101_);
              "
            >
              <path
                class="st1"
                d="M375,333l-0.1-0.9l-0.1-0.8l-0.1-0.9l-0.1-0.9l-0.1-0.8l-0.1-0.9l-0.1-0.8l-0.2-0.9l-0.2-0.8l-0.2-0.8
                      l-0.2-0.8l-0.2-0.8l-0.2-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8
                      l-0.4-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7L365,308l-0.6-0.6l-0.6-0.6l-0.6-0.6l-0.6-0.6L362,305
                      l-0.6-0.6l-0.7-0.6l-0.6-0.5l-1.2,0.7l-0.8,0.5l-0.8,0.4l-0.8,0.4l-0.8,0.4l-0.8,0.4l-0.9,0.4l-0.9,0.4l-0.9,0.3l-0.9,0.3
                      l-0.9,0.3l-0.9,0.3l-0.9,0.3l-0.9,0.3l-0.9,0.2l-0.9,0.2l-0.9,0.2l-0.9,0.2l-0.9,0.2l-0.9,0.1l-0.9,0.1l-0.9,0.1l-0.9,0.1
                      l-0.9,0.1l-0.9,0.1l-0.9,0.1l-0.9,0l-0.9,0h-57.5l59.7,16.4l0.4,0.1l0.4,0.1l0.4,0.1l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2
                      l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.1,0.3l0.1,0.3l0.1,0.4l0.1,0.4
                      l0.1,0.4l0.1,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.3l-0.1,0.4l-0.1,0.3l-0.2,0.3l-0.2,0.3
                      l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.3,0.3l-0.3,0.3l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2
                      l-0.3,0.1l-0.4,0.2l-0.4,0.1l-0.3,0.1l-0.4,0.1l-0.4,0.1l-0.4,0.1l-0.4,0l-0.4,0l-0.4,0H125V375h209.7l0.9,0l0.9,0l0.9,0l0.8-0.1
                      l0.9-0.1l0.8-0.1l0.9-0.1l0.8-0.1l0.8-0.1l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.3
                      l0.8-0.4l0.8-0.4l0.8-0.4l0.8-0.4l0.8-0.4l0.7-0.4l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5
                      l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.4-0.7
                      l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.3-0.8l0.3-0.8l0.3-0.8l0.3-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8
                      l0.2-0.8l0.1-0.8l0.1-0.9l0.1-0.9l0.1-0.8l0.1-0.9l0.1-0.9l0.1-0.8l0-0.9l0-0.9l0-0.8L375,333z"
              />
              <path
                class="st1"
                d="M375,260.4l-0.1-0.9l-0.1-0.9l-0.1-0.8l-0.1-0.9l-0.1-0.8l-0.1-0.8l-0.1-0.8l-0.2-0.8l-0.2-0.8l-0.2-0.8
                      l-0.2-0.8l-0.2-0.8l-0.2-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.7
                      l-0.4-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.2-0.2h0h-89.8l59.7,16.4l0.4,0.1l0.4,0.1l0.4,0.1l0.3,0.2l0.3,0.2l0.3,0.2
                      l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.1,0.4l0.1,0.3
                      l0.1,0.4l0.1,0.4l0.1,0.4l0.1,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.3l-0.1,0.4
                      l-0.2,0.4l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.3,0.3l-0.3,0.3l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2
                      l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.4,0.2l-0.4,0.1l-0.3,0.1l-0.4,0.1l-0.4,0.1l-0.4,0.1l-0.4,0l-0.4,0l-0.4,0h-82.5h-111H125v32.2
                      h122.8h86.9h0.9l0.9,0l0.9-0.1l0.8-0.1l0.9-0.1l0.8-0.1l0.9-0.1l0.8-0.1l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.3
                      l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.4l0.8-0.4l0.2-0.1l0.6-0.3l0.8-0.4l0.8-0.4l0.7-0.4l0.7-0.4l0.7-0.5l0.7-0.5l0.7-0.5
                      l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.5-0.7l0.5-0.7l0.5-0.7
                      l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.4-0.7l0.4-0.7l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.3-0.8l0.3-0.8l0.3-0.8l0.3-0.8
                      l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.1-0.8l0.1-0.9l0.1-0.8l0.1-0.9l0.1-0.8l0.1-0.9l0.1-0.9l0-0.8l0-0.9l0-0.9
                      L375,260.4z"
              />
              <path
                class="st1"
                d="M165.3,197.6l-0.9,0l-0.8,0l-0.9,0l-0.9,0.1l-0.8,0.1l-0.9,0.1l-0.8,0.1l-0.8,0.1l-0.8,0.2l-0.8,0.2l-0.8,0.2
                      l-0.8,0.2l-0.8,0.2l-0.8,0.2l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.4l-0.8,0.4l-0.2,0.1l-0.6,0.3l-0.8,0.4
                      l-0.8,0.4l-0.8,0.4l-0.7,0.4l-0.7,0.5l-0.7,0.5L142,205l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6
                      l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.5,0.6l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.4,0.7l-0.5,0.7l-0.4,0.7
                      l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.2,0.8l-0.2,0.8l-0.2,0.8
                      l-0.2,0.8l-0.2,0.8l-0.2,0.8l-0.1,0.9l-0.1,0.9l-0.1,0.8l-0.1,0.9l-0.1,0.9l0,0.9l0,0.9v0.9v0.9l0,0.8l0,0.9l0.1,0.8l0.1,0.8
                      l0.1,0.9l0.1,0.9l0.1,0.8l0.2,0.9l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8
                      l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.7l0.5,0.7l0.4,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.2,0.2h89.8l-59.7-16.4l-0.4-0.1l-0.3-0.1
                      l-0.4-0.1l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3
                      l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.1-0.4l-0.1-0.4l-0.1-0.3l-0.1-0.4l-0.1-0.4l-0.1-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0-0.4
                      l0-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3
                      l0.3-0.3l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.4-0.2l0.3-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4,0l0.4,0
                      h0.4h82.5h111H375v-32.3H252.2H165.3z"
              />
              <path
                class="st1"
                d="M165.3,125l-0.9,0l-0.8,0l-0.9,0.1l-0.9,0.1l-0.8,0.1l-0.9,0.1l-0.8,0.1l-0.8,0.1l-0.8,0.2l-0.8,0.2l-0.8,0.2
                      l-0.8,0.2l-0.8,0.2l-0.8,0.2l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.4l-0.8,0.4l-0.8,0.4l-0.8,0.4
                      l-0.8,0.4l-0.7,0.5l-0.7,0.4l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.6l-0.7,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6
                      l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.4,0.7l-0.5,0.7l-0.4,0.7
                      l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.2,0.8l-0.2,0.8l-0.2,0.8
                      l-0.2,0.8l-0.2,0.8l-0.2,0.8l-0.1,0.9l-0.1,0.8l-0.1,0.9l-0.1,0.8l-0.1,0.9l0,0.9l0,0.9v0.9v0.9l0,0.9l0,0.8l0.1,0.9l0.1,0.9
                      l0.1,0.8l0.1,0.8l0.1,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8
                      l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.7l0.5,0.7l0.4,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.6,0.6l0.6,0.6
                      l0.6,0.6l0.6,0.6l0.6,0.6l0.6,0.6l0.6,0.6l0.7,0.6l0.6,0.5h0l1.1-0.7l0.8-0.5l0.8-0.5l0.8-0.4l0.8-0.4l0.9-0.4l0.9-0.4l0.9-0.4
                      l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.2l0.9-0.2l0.9-0.2l0.9-0.2l0.9-0.2l0.9-0.1l0.9-0.1l0.9-0.1l0.9-0.1
                      l0.9-0.1l0.9-0.1l0.9,0l0.9,0l0.9,0h57.5l-59.7-16.4l-0.4-0.1l-0.3-0.1l-0.4-0.1l-0.3-0.1l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2
                      l-0.3-0.2l-0.3-0.2l-0.3-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.1-0.3l-0.1-0.4
                      l-0.1-0.3l-0.1-0.4l-0.1-0.4l-0.1-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.3
                      l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2
                      l0.3-0.2l0.4-0.1l0.3-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4,0l0.4,0l0.4,0H375V125H165.3z"
              />
            </g>
          </g>
        </svg>
        Seqera
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://github.com/nextflow-io/training"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"
          ></path>
        </svg>
        Training on GitHub
      </a>
    </li>
  </ul>
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nf-test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing with nf-test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Fundamentals Training
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fundamentals Training
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientação
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intro
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/rnaseq_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rnaseq pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Containers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/channels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Channels
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/processes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/operators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/groovy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introdução ao Groovy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Modules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuração
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/executors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Executors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/seqera_platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Seqera Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/cache_and_resume/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache e reentrância
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/basic_training/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resolução de problemas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced Training
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced Training
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Training
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/orientation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orientation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/operators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operator Tour
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metadata Propagation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/grouping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grouping and Splitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/groovy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Groovy Imports
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/advanced/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Help
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                      

<nav class="md-nav md-nav--secondary" aria-label="On this page">
       
  <label class="md-nav__title" for="__toc">
    <span class="md-nav__icon md-icon"></span>
    On this page
  </label>
  <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
     <li class="md-nav__item">
  <a href="#learning-goals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Learning goals
      
    </span>
  </a>
  
</li>  <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>  <li class="md-nav__item">
  <a href="#0-get-started" class="md-nav__link">
    <span class="md-ellipsis">
      
        0. Get started
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="0. Get started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open-the-training-codespace" class="md-nav__link">
    <span class="md-ellipsis">
      
        Open the training codespace
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-into-the-project-directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Move into the project directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#review-the-materials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Review the materials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readiness-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Readiness checklist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#1-dataflow-vs-scripting-understanding-the-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Dataflow vs Scripting: Understanding the Boundaries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Dataflow vs Scripting: Understanding the Boundaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-identifying-whats-what" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1. Identifying What's What
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1. Identifying What&#39;s What">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-basic-nextflow-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.1. Basic Nextflow Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-adding-the-map-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.2. Adding the Map Operator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-creating-a-map-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.3. Creating a Map Data Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-adding-conditional-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.4. Adding Conditional Logic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-subsetting-maps-with-submap" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.5. Subsetting Maps with .subMap()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116-combining-maps-and-returning-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1.6. Combining Maps and Returning Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-understanding-different-types-channel-vs-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2. Understanding Different Types: Channel vs List
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-the-spread-operator-shorthand-for-property-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3. The Spread Operator (*.) - Shorthand for Property Extraction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#2-string-processing-and-dynamic-script-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. String Processing and Dynamic Script Generation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. String Processing and Dynamic Script Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-pattern-matching-and-regular-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1. Pattern Matching and Regular Expressions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dynamic-script-generation-in-processes" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2. Dynamic Script Generation in Processes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-variable-interpolation-nextflow-and-shell-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3. Variable Interpolation: Nextflow and Shell Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#3-creating-reusable-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Creating Reusable Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Creating Reusable Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#takeaway_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#4-dynamic-resource-directives-with-closures" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Dynamic Resource Directives with Closures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Dynamic Resource Directives with Closures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#takeaway_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#5-conditional-logic-and-process-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Conditional Logic and Process Control
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Conditional Logic and Process Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-routing-with-branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Routing with .branch()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-using-filter-with-truthiness" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Using .filter() with Truthiness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#6-safe-navigation-and-elvis-operators" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Safe Navigation and Elvis Operators
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Safe Navigation and Elvis Operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-the-problem-accessing-properties-that-dont-exist" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1. The Problem: Accessing Properties That Don't Exist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-safe-navigation-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2. Safe Navigation Operator (?.)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-elvis-operator-for-defaults" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3. Elvis Operator (?:) for Defaults
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#7-validation-with-error-and-logwarn" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Validation with error() and log.warn
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Validation with error() and log.warn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#takeaway_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#8-workflow-event-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Workflow Event Handlers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Workflow Event Handlers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-the-oncomplete-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1. The onComplete Handler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-the-onerror-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2. The onError Handler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takeaway_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Takeaway
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional resources
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>  <li class="md-nav__item">
  <a href="#whats-next" class="md-nav__link">
    <span class="md-ellipsis">
      
        What's next?
      
    </span>
  </a>
  
</li> 
  </ul>
  
</nav>
<nav class="md-nav md-nav--secondary sidebar_resources" aria-label="Resources">
  <label class="md-nav__title">Resources</label>
  <ul class="md-nav__list">
    <li class="md-nav__item">
      <a
        href="https://nextflow.io/docs/latest/index.html"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M17.5 14.33c.79 0 1.63.08 2.5.24v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.33-4.5.99v-1.69c1.17-.53 2.67-.8 4.5-.8M13 12.46c1.29-.53 2.79-.79 4.5-.79.79 0 1.63.07 2.5.23v1.5c-.62-.16-1.46-.24-2.5-.24-1.9 0-3.39.34-4.5.99m4.5-3.65c-1.9 0-3.39.32-4.5 1V9.84c1.23-.56 2.73-.84 4.5-.84.79 0 1.63.08 2.5.23v1.55c-.74-.19-1.59-.28-2.5-.28m3.5 8V7c-1.04-.33-2.21-.5-3.5-.5-2.05 0-3.88.5-5.5 1.5v11.5c1.62-1 3.45-1.5 5.5-1.5 1.19 0 2.36.16 3.5.5m-3.5-14c2.35 0 4.19.5 5.5 1.5v14.56c0 .12-.05.24-.16.35-.11.09-.23.17-.34.17-.11 0-.19-.02-.25-.05-1.28-.69-2.87-1.03-4.75-1.03-2.05 0-3.88.5-5.5 1.5-1.34-1-3.17-1.5-5.5-1.5-1.66 0-3.25.36-4.75 1.07-.03.01-.07.01-.12.03-.04.01-.08.02-.13.02-.11 0-.23-.04-.34-.12a.475.475 0 0 1-.16-.35V6c1.34-1 3.18-1.5 5.5-1.5 2.33 0 4.16.5 5.5 1.5 1.34-1 3.17-1.5 5.5-1.5Z"
          ></path>
        </svg>
        Nextflow Docs
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://www.nextflow.io/slack-invite.html"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M6 15a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2h2v2m1 0a2 2 0 0 1 2-2 2 2 0 0 1 2 2v5a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-5m2-8a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2v2H9m0 1a2 2 0 0 1 2 2 2 2 0 0 1-2 2H4a2 2 0 0 1-2-2 2 2 0 0 1 2-2h5m8 2a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2h-2v-2m-1 0a2 2 0 0 1-2 2 2 2 0 0 1-2-2V5a2 2 0 0 1 2-2 2 2 0 0 1 2 2v5m-2 8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2v-2h2m0-1a2 2 0 0 1-2-2 2 2 0 0 1 2-2h5a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-5Z"
          ></path>
        </svg>
        Nextflow Slack
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://nextflow.io/"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="80 50 350 350"
        >
          <style type="text/css">
            .st0 {
              fill: "gray";
            }
          </style>
          <path
            class="st0"
            d="M124.5,171.5c39.4,2.6,71.1,34.3,73.5,73.8h46.1c-2.6-65-54.7-117.2-119.6-119.9V171.5z"
          />
          <path
            class="st0"
            d="M198.3,255.8c-2.6,39.5-34.3,71.1-73.8,73.5v46.1c65-2.6,117.2-54.7,119.9-119.6H198.3z"
          />
          <path
            class="st0"
            d="M300.7,245c2.6-39.5,34.3-71.1,73.8-73.5v-46.1c-65,2.6-117.2,54.7-119.9,119.6H300.7z"
          />
          <path
            class="st0"
            d="M374.5,329.3c-39.4-2.6-71.1-34.3-73.5-73.8h-46.1c2.6,65,54.7,117.2,119.6,119.9V329.3z"
          />
        </svg>
        Nextflow Homepage
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://seqera.io/"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <?xml version="1.0" encoding="utf-8"?>
        <!-- Generator: Adobe Illustrator 28.3.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
        <svg
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          viewBox="80 50 350 350"
          style="enable-background: new 0 0 500 500"
          xml:space="preserve"
        >
          <style type="text/css">
            .st0 {
              clip-path: url(#SVGID_00000006699037935518914080000000086571810102047141_);
            }
            .st1 {
              fill: "gray";
            }
          </style>
          <g>
            <defs>
              <rect id="SVGID_1_" x="125" y="125" width="250" height="250" />
            </defs>
            <clipPath
              id="SVGID_00000183214694142566821210000012389151436317298101_"
            >
              <use xlink:href="#SVGID_1_" style="overflow: visible" />
            </clipPath>
            <g
              style="
                clip-path: url(#SVGID_00000183214694142566821210000012389151436317298101_);
              "
            >
              <path
                class="st1"
                d="M375,333l-0.1-0.9l-0.1-0.8l-0.1-0.9l-0.1-0.9l-0.1-0.8l-0.1-0.9l-0.1-0.8l-0.2-0.9l-0.2-0.8l-0.2-0.8
                      l-0.2-0.8l-0.2-0.8l-0.2-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8
                      l-0.4-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7L365,308l-0.6-0.6l-0.6-0.6l-0.6-0.6l-0.6-0.6L362,305
                      l-0.6-0.6l-0.7-0.6l-0.6-0.5l-1.2,0.7l-0.8,0.5l-0.8,0.4l-0.8,0.4l-0.8,0.4l-0.8,0.4l-0.9,0.4l-0.9,0.4l-0.9,0.3l-0.9,0.3
                      l-0.9,0.3l-0.9,0.3l-0.9,0.3l-0.9,0.3l-0.9,0.2l-0.9,0.2l-0.9,0.2l-0.9,0.2l-0.9,0.2l-0.9,0.1l-0.9,0.1l-0.9,0.1l-0.9,0.1
                      l-0.9,0.1l-0.9,0.1l-0.9,0.1l-0.9,0l-0.9,0h-57.5l59.7,16.4l0.4,0.1l0.4,0.1l0.4,0.1l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2
                      l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.1,0.3l0.1,0.3l0.1,0.4l0.1,0.4
                      l0.1,0.4l0.1,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.3l-0.1,0.4l-0.1,0.3l-0.2,0.3l-0.2,0.3
                      l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.3,0.3l-0.3,0.3l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2
                      l-0.3,0.1l-0.4,0.2l-0.4,0.1l-0.3,0.1l-0.4,0.1l-0.4,0.1l-0.4,0.1l-0.4,0l-0.4,0l-0.4,0H125V375h209.7l0.9,0l0.9,0l0.9,0l0.8-0.1
                      l0.9-0.1l0.8-0.1l0.9-0.1l0.8-0.1l0.8-0.1l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.3
                      l0.8-0.4l0.8-0.4l0.8-0.4l0.8-0.4l0.8-0.4l0.7-0.4l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5
                      l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.4-0.7
                      l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.3-0.8l0.3-0.8l0.3-0.8l0.3-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8
                      l0.2-0.8l0.1-0.8l0.1-0.9l0.1-0.9l0.1-0.8l0.1-0.9l0.1-0.9l0.1-0.8l0-0.9l0-0.9l0-0.8L375,333z"
              />
              <path
                class="st1"
                d="M375,260.4l-0.1-0.9l-0.1-0.9l-0.1-0.8l-0.1-0.9l-0.1-0.8l-0.1-0.8l-0.1-0.8l-0.2-0.8l-0.2-0.8l-0.2-0.8
                      l-0.2-0.8l-0.2-0.8l-0.2-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.3-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.8l-0.4-0.7
                      l-0.4-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.5-0.7l-0.2-0.2h0h-89.8l59.7,16.4l0.4,0.1l0.4,0.1l0.4,0.1l0.3,0.2l0.3,0.2l0.3,0.2
                      l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.2l0.3,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.2,0.3l0.1,0.4l0.1,0.3
                      l0.1,0.4l0.1,0.4l0.1,0.4l0.1,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l0,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.4l-0.1,0.3l-0.1,0.4
                      l-0.2,0.4l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.2,0.3l-0.3,0.3l-0.3,0.3l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.3,0.2
                      l-0.3,0.2l-0.3,0.2l-0.3,0.2l-0.4,0.2l-0.4,0.1l-0.3,0.1l-0.4,0.1l-0.4,0.1l-0.4,0.1l-0.4,0l-0.4,0l-0.4,0h-82.5h-111H125v32.2
                      h122.8h86.9h0.9l0.9,0l0.9-0.1l0.8-0.1l0.9-0.1l0.8-0.1l0.9-0.1l0.8-0.1l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.2l0.8-0.3
                      l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.3l0.8-0.4l0.8-0.4l0.2-0.1l0.6-0.3l0.8-0.4l0.8-0.4l0.7-0.4l0.7-0.4l0.7-0.5l0.7-0.5l0.7-0.5
                      l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.5l0.7-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.6-0.6l0.5-0.7l0.5-0.7l0.5-0.7
                      l0.5-0.7l0.5-0.7l0.5-0.7l0.5-0.7l0.4-0.7l0.4-0.7l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.4-0.8l0.3-0.8l0.3-0.8l0.3-0.8l0.3-0.8
                      l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.2-0.8l0.1-0.8l0.1-0.9l0.1-0.8l0.1-0.9l0.1-0.8l0.1-0.9l0.1-0.9l0-0.8l0-0.9l0-0.9
                      L375,260.4z"
              />
              <path
                class="st1"
                d="M165.3,197.6l-0.9,0l-0.8,0l-0.9,0l-0.9,0.1l-0.8,0.1l-0.9,0.1l-0.8,0.1l-0.8,0.1l-0.8,0.2l-0.8,0.2l-0.8,0.2
                      l-0.8,0.2l-0.8,0.2l-0.8,0.2l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.4l-0.8,0.4l-0.2,0.1l-0.6,0.3l-0.8,0.4
                      l-0.8,0.4l-0.8,0.4l-0.7,0.4l-0.7,0.5l-0.7,0.5L142,205l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6
                      l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.5,0.6l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.4,0.7l-0.5,0.7l-0.4,0.7
                      l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.2,0.8l-0.2,0.8l-0.2,0.8
                      l-0.2,0.8l-0.2,0.8l-0.2,0.8l-0.1,0.9l-0.1,0.9l-0.1,0.8l-0.1,0.9l-0.1,0.9l0,0.9l0,0.9v0.9v0.9l0,0.8l0,0.9l0.1,0.8l0.1,0.8
                      l0.1,0.9l0.1,0.9l0.1,0.8l0.2,0.9l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8
                      l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.7l0.5,0.7l0.4,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.2,0.2h89.8l-59.7-16.4l-0.4-0.1l-0.3-0.1
                      l-0.4-0.1l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3
                      l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.1-0.4l-0.1-0.4l-0.1-0.3l-0.1-0.4l-0.1-0.4l-0.1-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0-0.4
                      l0-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3
                      l0.3-0.3l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.4-0.2l0.3-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4,0l0.4,0
                      h0.4h82.5h111H375v-32.3H252.2H165.3z"
              />
              <path
                class="st1"
                d="M165.3,125l-0.9,0l-0.8,0l-0.9,0.1l-0.9,0.1l-0.8,0.1l-0.9,0.1l-0.8,0.1l-0.8,0.1l-0.8,0.2l-0.8,0.2l-0.8,0.2
                      l-0.8,0.2l-0.8,0.2l-0.8,0.2l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.3l-0.8,0.4l-0.8,0.4l-0.8,0.4l-0.8,0.4
                      l-0.8,0.4l-0.7,0.5l-0.7,0.4l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.5l-0.7,0.6l-0.7,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6
                      l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.6,0.6l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.5,0.7l-0.4,0.7l-0.5,0.7l-0.4,0.7
                      l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.4,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.3,0.8l-0.2,0.8l-0.2,0.8l-0.2,0.8
                      l-0.2,0.8l-0.2,0.8l-0.2,0.8l-0.1,0.9l-0.1,0.8l-0.1,0.9l-0.1,0.8l-0.1,0.9l0,0.9l0,0.9v0.9v0.9l0,0.9l0,0.8l0.1,0.9l0.1,0.9
                      l0.1,0.8l0.1,0.8l0.1,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.2,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8l0.3,0.8
                      l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.8l0.4,0.7l0.5,0.7l0.4,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.5,0.7l0.6,0.6l0.6,0.6
                      l0.6,0.6l0.6,0.6l0.6,0.6l0.6,0.6l0.6,0.6l0.7,0.6l0.6,0.5h0l1.1-0.7l0.8-0.5l0.8-0.5l0.8-0.4l0.8-0.4l0.9-0.4l0.9-0.4l0.9-0.4
                      l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.3l0.9-0.2l0.9-0.2l0.9-0.2l0.9-0.2l0.9-0.2l0.9-0.1l0.9-0.1l0.9-0.1l0.9-0.1
                      l0.9-0.1l0.9-0.1l0.9,0l0.9,0l0.9,0h57.5l-59.7-16.4l-0.4-0.1l-0.3-0.1l-0.4-0.1l-0.3-0.1l-0.3-0.2l-0.3-0.2l-0.3-0.2l-0.3-0.2
                      l-0.3-0.2l-0.3-0.2l-0.3-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.2-0.3l-0.1-0.3l-0.1-0.4
                      l-0.1-0.3l-0.1-0.4l-0.1-0.4l-0.1-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.4l0.1-0.3
                      l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.2-0.3l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2l0.3-0.2
                      l0.3-0.2l0.4-0.1l0.3-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4-0.1l0.4,0l0.4,0l0.4,0H375V125H165.3z"
              />
            </g>
          </g>
        </svg>
        Seqera
      </a>
    </li>
    <li class="md-nav__item">
      <a
        href="https://github.com/nextflow-io/training"
        target="_blank"
        rel="noopener"
        class="md-nav__link"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"
          ></path>
        </svg>
        Training on GitHub
      </a>
    </li>
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/nextflow-io/training/edit/master/docs/side_quests/essential_scripting_patterns.md" title="Editar esta página" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="essential-nextflow-scripting-patterns">Essential Nextflow Scripting Patterns<a class="headerlink" href="#essential-nextflow-scripting-patterns" title="Permanent link">&para;</a></h1>
<p>Nextflow is a programming language that runs on the Java Virtual Machine. While Nextflow is built on <a href="http://groovy-lang.org/">Groovy</a> and shares much of its syntax, Nextflow is more than just "Groovy with extensions" -- it is a standalone language with a fully-specified <a href="https://nextflow.io/docs/latest/reference/syntax.html">syntax</a> and <a href="https://nextflow.io/docs/latest/reference/stdlib.html">standard library</a>.</p>
<p>You can write a lot of Nextflow without venturing beyond basic syntax for variables, maps, and lists. Most Nextflow tutorials focus on workflow orchestration (channels, processes, and data flow), and you can go surprisingly far with just that.</p>
<p>However, when you need to manipulate data, parse complex filenames, implement conditional logic, or build robust production workflows, it helps to think about two distinct aspects of your code: <strong>dataflow</strong> (channels, operators, processes, and workflows) and <strong>scripting</strong> (the code inside closures, functions, and process scripts). While this distinction is somewhat arbitrary—it's all Nextflow code—it provides a useful mental model for understanding when you're orchestrating your pipeline versus when you're manipulating data. Mastering both dramatically improves your ability to write clear, maintainable workflows.</p>
<h3 id="learning-goals">Learning goals<a class="headerlink" href="#learning-goals" title="Permanent link">&para;</a></h3>
<p>This side quest takes you on a hands-on journey from basic concepts to production-ready patterns.
We'll transform a simple CSV-reading workflow into a sophisticated bioinformatics pipeline, evolving it step-by-step through realistic challenges:</p>
<ul>
<li><strong>Understanding boundaries:</strong> Distinguish between dataflow operations and scripting, and understand how they work together</li>
<li><strong>Data manipulation:</strong> Extract, transform, and subset maps and collections using powerful operators</li>
<li><strong>String processing:</strong> Parse complex file naming schemes with regex patterns and master variable interpolation</li>
<li><strong>Reusable functions:</strong> Extract complex logic into named functions for cleaner, more maintainable workflows</li>
<li><strong>Dynamic logic:</strong> Build processes that adapt to different input types and use closures for dynamic resource allocation</li>
<li><strong>Conditional routing:</strong> Intelligently route samples through different processes based on their metadata characteristics</li>
<li><strong>Safe operations:</strong> Handle missing data gracefully with null-safe operators and validate inputs with clear error messages</li>
<li><strong>Configuration-based handlers:</strong> Use workflow event handlers for logging, notifications, and lifecycle management</li>
</ul>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<p>Before taking on this side quest, you should:</p>
<ul>
<li>Have completed the <a href="../hello_nextflow/README.md">Hello Nextflow</a> tutorial or equivalent beginner's course.</li>
<li>Be comfortable using basic Nextflow concepts and mechanisms (processes, channels, operators, working with files, meta data)</li>
<li>Have basic familiarity with common programming constructs (variables, maps, lists)</li>
</ul>
<p>This tutorial will explain programming concepts as we encounter them, so you don't need extensive programming experience.
We'll start with fundamental concepts and build up to advanced patterns.</p>
<hr />
<h2 id="0-get-started">0. Get started<a class="headerlink" href="#0-get-started" title="Permanent link">&para;</a></h2>
<h4 id="open-the-training-codespace">Open the training codespace<a class="headerlink" href="#open-the-training-codespace" title="Permanent link">&para;</a></h4>
<p>If you haven't yet done so, make sure to open the training environment as described in the <a href="../../envsetup/">Environment Setup</a>.</p>
<p><a href="https://codespaces.new/nextflow-io/training?quickstart=1&amp;ref=master"><img alt="Open in GitHub Codespaces" src="https://github.com/codespaces/badge.svg" /></a></p>
<h4 id="move-into-the-project-directory">Move into the project directory<a class="headerlink" href="#move-into-the-project-directory" title="Permanent link">&para;</a></h4>
<p>Let's move into the directory where the files for this tutorial are located.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>side-quests/essential_scripting_patterns
</code></pre></div>
<h4 id="review-the-materials">Review the materials<a class="headerlink" href="#review-the-materials" title="Permanent link">&para;</a></h4>
<p>You'll find a main workflow file and a <code>data</code> directory containing example data files.</p>
<div class="highlight"><span class="filename">Directory contents</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">.</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="go">├── collect.nf</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="go">├── data</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="go">│   ├── samples.csv</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="go">│   └── sequences</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="go">│       ├── SAMPLE_001_S1_L001_R1_001.fastq</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="go">│       ├── SAMPLE_002_S2_L001_R1_001.fastq</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="go">│       └── SAMPLE_003_S3_L001_R1_001.fastq</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="go">├── main.nf</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="go">├── modules</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="go">│   ├── fastp.nf</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="go">│   ├── generate_report.nf</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="go">│   └── trimgalore.nf</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="go">└── nextflow.config</span>
</code></pre></div>
<p>Our sample CSV contains information about biological samples that need different processing based on their characteristics:</p>
<div class="highlight"><span class="filename">samples.csv</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="go">sample_id,organism,tissue_type,sequencing_depth,file_path,quality_score</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="go">SAMPLE_001,human,liver,30000000,data/sequences/SAMPLE_001_S1_L001_R1_001.fastq,38.5</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="go">SAMPLE_002,mouse,brain,25000000,data/sequences/SAMPLE_002_S2_L001_R1_001.fastq,35.2</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="go">SAMPLE_003,human,kidney,45000000,data/sequences/SAMPLE_003_S3_L001_R1_001.fastq,42.1</span>
</code></pre></div>
<p>We'll use this realistic dataset to explore practical programming techniques that you'll encounter in real bioinformatics workflows.</p>
<!-- TODO: Can we make this more domain-agnostic? -->

<!-- TODO: add an assignment statement? #### Review the assignment -->

<h4 id="readiness-checklist">Readiness checklist<a class="headerlink" href="#readiness-checklist" title="Permanent link">&para;</a></h4>
<p>Think you're ready to dive in?</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I understand the goal of this course and its prerequisites</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> My codespace is up and running</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I've set my working directory appropriately</li>
</ul>
<!-- - [ ] I understand the assignment -->

<p>If you can check all the boxes, you're good to go.</p>
<hr />
<h2 id="1-dataflow-vs-scripting-understanding-the-boundaries">1. Dataflow vs Scripting: Understanding the Boundaries<a class="headerlink" href="#1-dataflow-vs-scripting-understanding-the-boundaries" title="Permanent link">&para;</a></h2>
<h3 id="11-identifying-whats-what">1.1. Identifying What's What<a class="headerlink" href="#11-identifying-whats-what" title="Permanent link">&para;</a></h3>
<p>When writing Nextflow workflows, it's important to distinguish between <strong>dataflow</strong> (how data moves through channels and processes) and <strong>scripting</strong> (the code that manipulates data and makes decisions). Let's build a workflow demonstrating how they work together.</p>
<h4 id="111-basic-nextflow-workflow">1.1.1. Basic Nextflow Workflow<a class="headerlink" href="#111-basic-nextflow-workflow" title="Permanent link">&para;</a></h4>
<p>Start with a simple workflow that just reads the CSV file (we've already done this for you in <code>main.nf</code>):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
<p>The <code>workflow</code> block defines our pipeline structure, while <code>channel.fromPath()</code> creates a channel from a file path. The <code>.splitCsv()</code> operator processes the CSV file and converts each row into a map data structure.</p>
<p>Run this workflow to see the raw CSV data:</p>
<div class="highlight"><span class="filename">Test basic workflow</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You should see output like:</p>
<div class="highlight"><span class="filename">Raw CSV data</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="go">Launching `main.nf` [marvelous_tuckerman] DSL2 - revision: 6113e05c17</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="go">[sample_id:SAMPLE_001, organism:human, tissue_type:liver, sequencing_depth:30000000, file_path:data/sequences/SAMPLE_001_S1_L001_R1_001.fastq, quality_score:38.5]</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="go">[sample_id:SAMPLE_002, organism:mouse, tissue_type:brain, sequencing_depth:25000000, file_path:data/sequences/SAMPLE_002_S2_L001_R1_001.fastq, quality_score:35.2]</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="go">[sample_id:SAMPLE_003, organism:human, tissue_type:kidney, sequencing_depth:45000000, file_path:data/sequences/SAMPLE_003_S3_L001_R1_001.fastq, quality_score:42.1]</span>
</code></pre></div>
<h4 id="112-adding-the-map-operator">1.1.2. Adding the Map Operator<a class="headerlink" href="#112-adding-the-map-operator" title="Permanent link">&para;</a></h4>
<p>Now we're going to add scripting to transform the data, using the <code>.map()</code> operator you will probably already be familiar with. This operator takes a 'closure' where we can write code to transform each item.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A <strong>closure</strong> is a block of code that can be passed around and executed later. Think of it as a function that you define inline. Closures are written with curly braces <code>{ }</code> and can take parameters. They're fundamental to how Nextflow operators work and if you've been writing Nextflow for a while, you may already have been using them without realizing it!</p>
</div>
<p>Here's what that map operation looks like:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">After</label><label for="__tabbed_1_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span>
<span class="normal"><a href="#__codelineno-6-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
</span><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">row</span>
</span><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="hll"><span class="w">        </span><span class="o">}</span>
</span><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>This is our first <strong>closure</strong> - an anonymous function you can pass as an argument (similar to lambdas in Python or arrow functions in JavaScript). Closures are essential for working with Nextflow operators.</p>
<p>The closure <code>{ row -&gt; return row }</code> takes a parameter <code>row</code> (could be any name: <code>item</code>, <code>sample</code>, etc.).</p>
<p>When the <code>.map()</code> operator processes each channel item, it passes that item to your closure. Here, <code>row</code> holds one CSV row at a time.</p>
<p>Apply this change and run the workflow:</p>
<div class="highlight"><span class="filename">Test map operator</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You'll see the same output as before, because we're simply returning the input unchanged. This confirms that the map operator is working correctly. Now let's start transforming the data.</p>
<h4 id="113-creating-a-map-data-structure">1.1.3. Creating a Map Data Structure<a class="headerlink" href="#113-creating-a-map-data-structure" title="Permanent link">&para;</a></h4>
<p>Now we're going to write <strong>scripting</strong> logic inside our closure to transform each row of data. This is where we process individual data items rather than orchestrating data flow.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">After</label><label for="__tabbed_2_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="hll"><span class="w">            </span><span class="c1">// Scripting for data transformation</span>
</span><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
</span><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="hll"><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
</span><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="hll"><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
</span><a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="hll"><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
</span><a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="hll"><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="hll"><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
</span><a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="hll"><span class="w">            </span><span class="o">]</span>
</span><a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">sample_meta</span>
</span><a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">row</span>
</span><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>The <code>sample_meta</code> map is a key-value data structure (like dictionaries in Python, objects in JavaScript, or hashes in Ruby) storing related information: sample ID, organism, tissue type, sequencing depth, and quality score.</p>
<p>We use string manipulation methods like <code>.toLowerCase()</code> and <code>.replaceAll()</code> to clean up our data, and type conversion methods like <code>.toInteger()</code> and <code>.toDouble()</code> to convert string data from the CSV into the appropriate numeric types.</p>
<p>Apply this change and run the workflow:</p>
<div class="highlight"><span class="filename">Test map data structure</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You should see the refined map output like:</p>
<div class="highlight"><span class="filename">Transformed metadata</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="go">[id:sample_001, organism:human, tissue:liver, depth:30000000, quality:38.5]</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="go">[id:sample_002, organism:mouse, tissue:brain, depth:25000000, quality:35.2]</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="go">[id:sample_003, organism:human, tissue:kidney, depth:45000000, quality:42.1]</span>
</code></pre></div>
<h4 id="114-adding-conditional-logic">1.1.4. Adding Conditional Logic<a class="headerlink" href="#114-adding-conditional-logic" title="Permanent link">&para;</a></h4>
<p>Now let's add more scripting - this time using a ternary operator to make decisions based on data values.</p>
<p>Make the following change:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">After</label><label for="__tabbed_3_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">]</span>
</span><a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">sample_meta</span>
</span><a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>The ternary operator is a shorthand for an if/else statement that follows the pattern <code>condition ? value_if_true : value_if_false</code>. This line means: "If the quality is greater than 40, use 'high', otherwise use 'normal'". Its cousin, the <strong>Elvis operator</strong> (<code>?:</code>), provides default values when something is null or empty - we'll explore that pattern later in this tutorial.</p>
<p>The map addition operator <code>+</code> creates a <strong>new map</strong> rather than modifying the existing one. This line creates a new map that contains all the key-value pairs from <code>sample_meta</code> plus the new <code>priority</code> key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Never modify maps passed into closures - always create new ones using <code>+</code> (for example). In Nextflow, the same data often flows through multiple operations simultaneously. Modifying a map in-place can cause unpredictable side effects when other operations reference that same object. Creating new maps ensures each operation has its own clean copy.</p>
</div>
<p>Run the modified workflow:</p>
<div class="highlight"><span class="filename">Test conditional logic</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You should see output like:</p>
<div class="highlight"><span class="filename">Metadata with priority</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="go">[id:sample_001, organism:human, tissue:liver, depth:30000000, quality:38.5, priority:normal]</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="go">[id:sample_002, organism:mouse, tissue:brain, depth:25000000, quality:35.2, priority:normal]</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="go">[id:sample_003, organism:human, tissue:kidney, depth:45000000, quality:42.1, priority:high]</span>
</code></pre></div>
<p>We've successfully added conditional logic to enrich our metadata with a priority level based on quality scores.</p>
<h4 id="115-subsetting-maps-with-submap">1.1.5. Subsetting Maps with <code>.subMap()</code><a class="headerlink" href="#115-subsetting-maps-with-submap" title="Permanent link">&para;</a></h4>
<p>While the <code>+</code> operator adds keys to a map, sometimes you need to do the opposite - extract only specific keys. The <code>.subMap()</code> method is perfect for this.</p>
<p>Let's add a line to create a simplified version of our metadata that only contains identification fields:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">After</label><label for="__tabbed_4_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">            </span><span class="c1">// Scripting for data transformation</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">id_only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">subMap</span><span class="o">([</span><span class="s1">&#39;id&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;organism&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;tissue&#39;</span><span class="o">])</span>
</span><a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="hll"><span class="w">            </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;ID fields only: ${id_only}&quot;</span>
</span><a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="hll">
</span><a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">]</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">            </span><span class="c1">// Scripting for data transformation</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">]</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Run the modified workflow:</p>
<div class="highlight"><span class="filename">Test subMap</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You should see output showing both the full metadata displayed by the <code>view()</code> operation and the extracted subset we printed with <code>println</code>:</p>
<div class="highlight"><span class="filename">SubMap results</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="go">Launching `main.nf` [peaceful_cori] DSL2 - revision: 4cc4a8340f</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="go">ID fields only: [id:sample_001, organism:human, tissue:liver]</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="go">ID fields only: [id:sample_002, organism:mouse, tissue:brain]</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="go">ID fields only: [id:sample_003, organism:human, tissue:kidney]</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="go">[id:sample_001, organism:human, tissue:liver, depth:30000000, quality:38.5, priority:normal]</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="go">[id:sample_002, organism:mouse, tissue:brain, depth:25000000, quality:35.2, priority:normal]</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="go">[id:sample_003, organism:human, tissue:kidney, depth:45000000, quality:42.1, priority:high]</span>
</code></pre></div>
<p>The <code>.subMap()</code> method takes a list of keys and returns a new map containing only those keys. If a key doesn't exist in the original map, it's simply not included in the result.</p>
<p>This is particularly useful when you need to create different metadata versions for different processes - some might need full metadata while others need only minimal identification fields.</p>
<p>Now remove those println statements to restore your workflow to its previous state, as we don't need them going forward.</p>
<div class="admonition tip">
<p class="admonition-title">Map Operations Summary</p>
<ul>
<li><strong>Add keys</strong>: <code>map1 + [new_key: value]</code> - Creates new map with additional keys</li>
<li><strong>Extract keys</strong>: <code>map1.subMap(['key1', 'key2'])</code> - Creates new map with only specified keys</li>
<li><strong>Both operations create new maps</strong> - Original maps remain unchanged</li>
</ul>
</div>
<h4 id="116-combining-maps-and-returning-results">1.1.6. Combining Maps and Returning Results<a class="headerlink" href="#116-combining-maps-and-returning-results" title="Permanent link">&para;</a></h4>
<p>So far, we've only been returning what the Nextflow community calls the 'meta map', and we've been ignoring the files those metadata relate to. But if you're writing Nextflow workflows, you probably want to do something with those files.</p>
<p>Let's output a channel structure comprising a tuple of 2 elements: the enriched metadata map and the corresponding file path. This is a common pattern in Nextflow for passing data to processes.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">After</label><label for="__tabbed_5_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span><span class="w"> </span><span class="o">)</span>
</span><a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">]</span>
</span><a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Apply this change and run the workflow:</p>
<div class="highlight"><span class="filename">Test complete workflow</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You should see output like:</p>
<div class="highlight"><span class="filename">Complete workflow output</span><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="go">[[id:sample_001, organism:human, tissue:liver, depth:30000000, quality:38.5, priority:normal], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_001_S1_L001_R1_001.fastq]</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="go">[[id:sample_002, organism:mouse, tissue:brain, depth:25000000, quality:35.2, priority:normal], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_002_S2_L001_R1_001.fastq]</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="go">[[id:sample_003, organism:human, tissue:kidney, depth:45000000, quality:42.1, priority:high], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_003_S3_L001_R1_001.fastq]</span>
</code></pre></div>
<p>This <code>[meta, file]</code> tuple structure is a common pattern in Nextflow for passing both metadata and associated files to processes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Maps and Metadata</strong>: Maps are fundamental to working with metadata in Nextflow. For a more detailed explanation of working with metadata maps, see the <a href="../metadata/">Working with metadata</a> side quest.</p>
</div>
<p>Our workflow demonstrates the core pattern: <strong>dataflow operations</strong> (<code>workflow</code>, <code>channel.fromPath()</code>, <code>.splitCsv()</code>, <code>.map()</code>, <code>.view()</code>) orchestrate how data moves through the pipeline, while <strong>scripting</strong> (maps <code>[key: value]</code>, string methods, type conversions, ternary operators) inside the <code>.map()</code> closure handles the transformation of individual data items.</p>
<h3 id="12-understanding-different-types-channel-vs-list">1.2. Understanding Different Types: Channel vs List<a class="headerlink" href="#12-understanding-different-types-channel-vs-list" title="Permanent link">&para;</a></h3>
<p>So far, so good, we can distinguish between dataflow operations and scripting. But what about when the same method name exists in both contexts?</p>
<p>A perfect example is the <code>collect</code> method, which exists for both channel types and List types in the Nextflow standard library. The <code>collect()</code> method on a List transforms each element, while the <code>collect()</code> operator on a channel gathers all channel emissions into a single-item channel.</p>
<p>Let's demonstrate this with some sample data, starting by refreshing ourselves on what the channel <code>collect()</code> operator does. Check out <code>collect.nf</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">collect.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">sample_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;sample_001&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_002&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_003&#39;</span><span class="o">]</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="c1">// channel.collect() - groups multiple channel emissions into one</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="n">ch_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromList</span><span class="o">(</span><span class="n">sample_ids</span><span class="o">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="n">ch_input</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;Individual channel item: ${sample}&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="n">ch_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_input</span><span class="o">.</span><span class="na">collect</span><span class="o">()</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="n">ch_collected</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;channel.collect() result: ${list} (${list.size()} items grouped into 1)&quot;</span><span class="w"> </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
<p>Steps:</p>
<ul>
<li>Define a List of sample IDs</li>
<li>Create a channel with <code>fromList()</code> that emits each sample ID separately</li>
<li>Print each item with <code>view()</code> as it flows through</li>
<li>Gather all items into a single list with the channel's <code>collect()</code> operator</li>
<li>Print the collected result (single item containing all sample IDs) with a second <code>view()</code></li>
</ul>
<p>We've changed the structure of the channel, but we haven't changed the data itself.</p>
<p>Run the workflow to confirm this:</p>
<div class="highlight"><span class="filename">Test collect operations</span><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>collect.nf
</code></pre></div>
<div class="highlight"><span class="filename">Different collect behaviors</span><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="go">Launching `collect.nf` [loving_mendel] DSL2 - revision: e8d054a46e</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="go">Individual channel item: sample_001</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="go">Individual channel item: sample_002</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="go">Individual channel item: sample_003</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="go">channel.collect() result: [sample_001, sample_002, sample_003] (3 items grouped into 1)</span>
</code></pre></div>
<p><code>view()</code> returns an output for every channel emission, so we know that this single output contains all 3 original items grouped into one list.</p>
<p>Now let's see the <code>collect</code> method on a List in action. Modify <code>collect.nf</code> to apply the List's <code>collect</code> method to the original list of sample IDs:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">After</label><label for="__tabbed_6_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">sample_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;sample_001&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_002&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_003&#39;</span><span class="o">]</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="c1">// channel.collect() - groups multiple channel emissions into one</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="n">ch_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromList</span><span class="o">(</span><span class="n">sample_ids</span><span class="o">)</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="n">ch_input</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;Individual channel item: ${sample}&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="n">ch_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_input</span><span class="o">.</span><span class="na">collect</span><span class="o">()</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="n">ch_collected</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;channel.collect() result: ${list} (${list.size()} items grouped into 1)&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="hll"><span class="c1">// List.collect() - transforms each element, preserves structure</span>
</span><a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="hll"><span class="kt">def</span><span class="w"> </span><span class="n">formatted_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_ids</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span>
</span><a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="hll"><span class="w">    </span><span class="n">id</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s1">&#39;SAMPLE_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;SPECIMEN_&#39;</span><span class="o">)</span>
</span><a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="hll"><span class="o">}</span>
</span><a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="hll"><span class="n">println</span><span class="w"> </span><span class="s2">&quot;List.collect() result: ${formatted_ids} (${sample_ids.size()} items transformed into ${formatted_ids.size()})&quot;</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span>
<span class="normal"><a href="#__codelineno-29-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">sample_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;sample_001&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_002&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_003&#39;</span><span class="o">]</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="c1">// channel.collect() - groups multiple channel emissions into one</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="n">ch_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromList</span><span class="o">(</span><span class="n">sample_ids</span><span class="o">)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="n">ch_input</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;Individual channel item: ${sample}&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="n">ch_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_input</span><span class="o">.</span><span class="na">collect</span><span class="o">()</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="n">ch_collected</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;channel.collect() result: ${list} (${list.size()} items grouped into 1)&quot;</span><span class="w"> </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>In this new snippet we:</p>
<ul>
<li>Define a new variable <code>formatted_ids</code> that uses the List's <code>collect</code> method to transform each sample ID in the original list</li>
<li>Print the result using <code>println</code></li>
</ul>
<p>Run the modified workflow:</p>
<div class="highlight"><span class="filename">Test List collect</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>collect.nf
</code></pre></div>
<div class="highlight"><span class="filename">List collect results</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="go">Launching `collect.nf` [cheeky_stonebraker] DSL2 - revision: 2d5039fb47</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="hll"><span class="go">List.collect() result: [SPECIMEN_001, SPECIMEN_002, SPECIMEN_003] (3 items transformed into 3)</span>
</span><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="go">Individual channel item: sample_001</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="go">Individual channel item: sample_002</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="go">Individual channel item: sample_003</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="go">channel.collect() result: [sample_001, sample_002, sample_003] (3 items grouped into 1)</span>
</code></pre></div>
<p>This time, we have NOT changed the structure of the data, we still have 3 items in the list, but we HAVE transformed each item using the List's <code>collect</code> method to produce a new list with modified values. This is similar to using the <code>map</code> operator on a channel, but it's operating on a List data structure rather than a channel.</p>
<p><code>collect</code> is an extreme case we're using here to make a point. The key lesson is that when you're writing workflows, always distinguish between <strong>data structures</strong> (Lists, Maps, etc.) and <strong>channels</strong> (dataflow constructs). Operations can share names but behave completely differently depending on the type they're called on.</p>
<h3 id="13-the-spread-operator-shorthand-for-property-extraction">1.3. The Spread Operator (<code>*.</code>) - Shorthand for Property Extraction<a class="headerlink" href="#13-the-spread-operator-shorthand-for-property-extraction" title="Permanent link">&para;</a></h3>
<p>Related to the List's <code>collect</code> method is the spread operator (<code>*.</code>), which provides a concise way to extract properties from collections. It's essentially syntactic sugar for a common <code>collect</code> pattern.</p>
<p>Let's add a demonstration to our <code>collect.nf</code> file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">After</label><label for="__tabbed_7_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">collect.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">sample_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;sample_001&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_002&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_003&#39;</span><span class="o">]</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="c1">// channel.collect() - groups multiple channel emissions into one</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="n">ch_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromList</span><span class="o">(</span><span class="n">sample_ids</span><span class="o">)</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="n">ch_input</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;Individual channel item: ${sample}&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="n">ch_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_input</span><span class="o">.</span><span class="na">collect</span><span class="o">()</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="n">ch_collected</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;channel.collect() result: ${list} (${list.size()} items grouped into 1)&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="c1">// List.collect() - transforms each element, preserves structure</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="kt">def</span><span class="w"> </span><span class="n">formatted_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_ids</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w">    </span><span class="n">id</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s1">&#39;SAMPLE_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;SPECIMEN_&#39;</span><span class="o">)</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="o">}</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="n">println</span><span class="w"> </span><span class="s2">&quot;List.collect() result: ${formatted_ids} (${sample_ids.size()} items transformed into ${formatted_ids.size()})&quot;</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="hll"><span class="c1">// Spread operator - concise property access</span>
</span><a id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="hll"><span class="kt">def</span><span class="w"> </span><span class="n">sample_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[[</span><span class="nl">id:</span><span class="w"> </span><span class="s1">&#39;s1&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">quality:</span><span class="w"> </span><span class="mf">38.5</span><span class="o">],</span><span class="w"> </span><span class="o">[</span><span class="nl">id:</span><span class="w"> </span><span class="s1">&#39;s2&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">quality:</span><span class="w"> </span><span class="mf">42.1</span><span class="o">],</span><span class="w"> </span><span class="o">[</span><span class="nl">id:</span><span class="w"> </span><span class="s1">&#39;s3&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">quality:</span><span class="w"> </span><span class="mf">35.2</span><span class="o">]]</span>
</span><a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="hll"><span class="kt">def</span><span class="w"> </span><span class="n">all_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_data</span><span class="o">*.</span><span class="na">id</span>
</span><a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="hll"><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Spread operator result: ${all_ids}&quot;</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">collect.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">sample_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;sample_001&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_002&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;sample_003&#39;</span><span class="o">]</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="c1">// channel.collect() - groups multiple channel emissions into one</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="n">ch_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromList</span><span class="o">(</span><span class="n">sample_ids</span><span class="o">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="n">ch_input</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;Individual channel item: ${sample}&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="n">ch_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_input</span><span class="o">.</span><span class="na">collect</span><span class="o">()</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="n">ch_collected</span><span class="o">.</span><span class="na">view</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;channel.collect() result: ${list} (${list.size()} items grouped into 1)&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="c1">// List.collect() - transforms each element, preserves structure</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="kt">def</span><span class="w"> </span><span class="n">formatted_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_ids</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">    </span><span class="n">id</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s1">&#39;SAMPLE_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;SPECIMEN_&#39;</span><span class="o">)</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="o">}</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="n">println</span><span class="w"> </span><span class="s2">&quot;List.collect() result: ${formatted_ids} (${sample_ids.size()} items transformed into ${formatted_ids.size()})&quot;</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Run the updated workflow:</p>
<div class="highlight"><span class="filename">Test spread operator</span><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>collect.nf
</code></pre></div>
<p>You should see output like:</p>
<div class="highlight"><span class="filename">Spread operator output</span><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="go">Launching `collect.nf` [cranky_galileo] DSL2 - revision: 5f3c8b2a91</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="go">List.collect() result: [SPECIMEN_001, SPECIMEN_002, SPECIMEN_003] (3 items transformed into 3)</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="hll"><span class="go">Spread operator result: [s1, s2, s3]</span>
</span><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="go">Individual channel item: sample_001</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="go">Individual channel item: sample_002</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="go">Individual channel item: sample_003</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="go">channel.collect() result: [sample_001, sample_002, sample_003] (3 items grouped into 1)</span>
</code></pre></div>
<p>The spread operator <code>*.</code> is a shorthand for a common collect pattern:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">// These are equivalent:</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="kt">def</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samples</span><span class="o">*.</span><span class="na">id</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="kt">def</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samples</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">it</span><span class="o">.</span><span class="na">id</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="c1">// Also works with method calls:</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="kt">def</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">files</span><span class="o">*.</span><span class="na">getName</span><span class="o">()</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="kt">def</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">files</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">it</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span><span class="w"> </span><span class="o">}</span>
</code></pre></div>
<p>The spread operator is particularly useful when you need to extract a single property from a list of objects - it's more readable than writing out the full <code>collect</code> closure.</p>
<div class="admonition tip">
<p class="admonition-title">When to Use Spread vs Collect</p>
<ul>
<li><strong>Use spread (<code>*.</code>)</strong> for simple property access: <code>samples*.id</code>, <code>files*.name</code></li>
<li><strong>Use collect</strong> for transformations or complex logic: <code>samples.collect { it.id.toUpperCase() }</code>, <code>samples.collect { [it.id, it.quality &gt; 40] }</code></li>
</ul>
</div>
<h3 id="takeaway">Takeaway<a class="headerlink" href="#takeaway" title="Permanent link">&para;</a></h3>
<p>In this section, you've learned:</p>
<ul>
<li><strong>Dataflow vs scripting</strong>: Channel operators orchestrate how data flows through your pipeline, while scripting transforms individual data items</li>
<li><strong>Understanding types</strong>: The same method name (like <code>collect</code>) can behave differently depending on the type it's called on (Channel vs List)</li>
<li><strong>Context matters</strong>: Always be aware of whether you're working with channels (dataflow) or data structures (scripting)</li>
</ul>
<p>Understanding these boundaries is essential for debugging, documentation, and writing maintainable workflows.</p>
<p>Next we'll dive deeper into string processing capabilities, which are essential for handling real-world data.</p>
<hr />
<h2 id="2-string-processing-and-dynamic-script-generation">2. String Processing and Dynamic Script Generation<a class="headerlink" href="#2-string-processing-and-dynamic-script-generation" title="Permanent link">&para;</a></h2>
<p>Mastering string processing separates brittle workflows from robust pipelines. This section covers parsing complex file names, dynamic script generation, and variable interpolation.</p>
<h3 id="21-pattern-matching-and-regular-expressions">2.1. Pattern Matching and Regular Expressions<a class="headerlink" href="#21-pattern-matching-and-regular-expressions" title="Permanent link">&para;</a></h3>
<p>Bioinformatics files often have complex naming conventions encoding metadata. Let's extract this automatically using pattern matching with regular expressions.</p>
<p>We're going to return to our <code>main.nf</code> workflow and add some pattern matching logic to extract additional sample information from file names. The FASTQ files in our dataset follow Illumina-style naming conventions with names like <code>SAMPLE_001_S1_L001_R1_001.fastq.gz</code>. These might look cryptic, but they actually encode useful metadata like sample ID, lane number, and read direction. We're going to use regex capabilities to parse these names.</p>
<p>Make the following change to your existing <code>main.nf</code> workflow:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">After</label><label for="__tabbed_8_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span>
<span class="normal"><a href="#__codelineno-37-24">24</a></span>
<span class="normal"><a href="#__codelineno-37-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">            </span><span class="c1">// Scripting for data transformation</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
</span><a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="hll">
</span><a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
</span><a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span>
</span><a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="hll"><span class="w">                </span><span class="nl">sample_num:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">].</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="hll"><span class="w">                </span><span class="nl">lane:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">],</span>
</span><a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="hll"><span class="w">                </span><span class="nl">read:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">],</span>
</span><a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="hll"><span class="w">                </span><span class="nl">chunk:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
</span><a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="hll"><span class="w">            </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
</span><a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="hll">
</span><a id="__codelineno-37-23" name="__codelineno-37-23"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-37-24" name="__codelineno-37-24"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
</span><a id="__codelineno-37-25" name="__codelineno-37-25"></a><span class="w">        </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="w">            </span><span class="c1">// Scripting for data transformation</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-38-14" name="__codelineno-38-14"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">))</span>
</span><a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="w">        </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>This demonstrates key <strong>string processing concepts</strong>:</p>
<ol>
<li><strong>Regular expression literals</strong> using <code>~/pattern/</code> syntax - this creates a regex pattern without needing to escape backslashes</li>
<li><strong>Pattern matching</strong> with the <code>=~</code> operator - this attempts to match a string against a regex pattern</li>
<li><strong>Matcher objects</strong> that capture groups with <code>[0][1]</code>, <code>[0][2]</code>, etc. - <code>[0]</code> refers to the entire match, <code>[1]</code>, <code>[2]</code>, etc. refer to captured groups in parentheses</li>
</ol>
<p>Let's break down the regex pattern <code>^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$</code>:</p>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Matches</th>
<th>Captures</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>^(.+)</code></td>
<td>Sample name from start</td>
<td>Group 1: sample name</td>
</tr>
<tr>
<td><code>_S(\d+)</code></td>
<td>Sample number <code>_S1</code>, <code>_S2</code>, etc.</td>
<td>Group 2: sample number</td>
</tr>
<tr>
<td><code>_L(\d{3})</code></td>
<td>Lane number <code>_L001</code></td>
<td>Group 3: lane (3 digits)</td>
</tr>
<tr>
<td><code>_(R[12])</code></td>
<td>Read direction <code>_R1</code> or <code>_R2</code></td>
<td>Group 4: read direction</td>
</tr>
<tr>
<td><code>_(\d{3})</code></td>
<td>Chunk number <code>_001</code></td>
<td>Group 5: chunk (3 digits)</td>
</tr>
<tr>
<td><code>\.fastq(?:\.gz)?$</code></td>
<td>File extension <code>.fastq</code> or <code>.fastq.gz</code></td>
<td>Not captured (?: is non-capturing)</td>
</tr>
</tbody>
</table>
<p>This parses Illumina-style naming conventions to extract metadata automatically.</p>
<p>Run the modified workflow:</p>
<div class="highlight"><span class="filename">Test pattern matching</span><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You should see output with metadata enriched from the file names, like</p>
<div class="highlight"><span class="filename">Metadata with file parsing</span><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="go">Launching `main.nf` [clever_pauling] DSL2 - revision: 605d2058b4</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="go">[[id:sample_001, organism:human, tissue:liver, depth:30000000, quality:38.5, sample_num:1, lane:001, read:R1, chunk:001, priority:normal], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_001_S1_L001_R1_001.fastq]</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="go">[[id:sample_002, organism:mouse, tissue:brain, depth:25000000, quality:35.2, sample_num:2, lane:001, read:R1, chunk:001, priority:normal], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_002_S2_L001_R1_001.fastq]</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="go">[[id:sample_003, organism:human, tissue:kidney, depth:45000000, quality:42.1, sample_num:3, lane:001, read:R1, chunk:001, priority:high], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_003_S3_L001_R1_001.fastq]</span>
</code></pre></div>
<h3 id="22-dynamic-script-generation-in-processes">2.2. Dynamic Script Generation in Processes<a class="headerlink" href="#22-dynamic-script-generation-in-processes" title="Permanent link">&para;</a></h3>
<p>Process script blocks are essentially multi-line strings that get passed to the shell. You can use <strong>conditional logic</strong> (if/else, ternary operators) to dynamically generate different script strings based on input characteristics. This is essential for handling diverse input types—like single-end vs paired-end sequencing reads—without duplicating process definitions.</p>
<p>Let's add a process to our workflow that demonstrates this pattern. Open <code>modules/fastp.nf</code> and take a look:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/fastp.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span>
<span class="normal"><a href="#__codelineno-41-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s1">&#39;community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690&#39;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">    </span><span class="nl">output:</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">sample_id</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="s2">&quot;*_trimmed*.fastq.gz&quot;</span><span class="o">),</span><span class="w"> </span><span class="nl">emit:</span><span class="w"> </span><span class="n">reads</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="s2">    fastp \\</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="s2">        --in1 ${reads[0]} \\</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="s2">        --in2 ${reads[1]} \\</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="s2">        --out1 ${meta.id}_trimmed_R1.fastq.gz \\</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="s2">        --out2 ${meta.id}_trimmed_R2.fastq.gz \\</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="s2">        --json ${meta.id}.fastp.json \\</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="s2">        --html ${meta.id}.fastp.html \\</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a><span class="s2">        --thread $task.cpus</span>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-41-21" name="__codelineno-41-21"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
<p>The process takes FASTQ files as input and runs the <code>fastp</code> tool to trim adapters and filter low-quality reads. Unfortunately, the person who wrote this process didn't allow for the single-end reads we have in our example dataset. Let's add it to our workflow and see what happens:</p>
<p>First, include the module at the very first line of your <code>main.nf</code> workflow:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
</code></pre></div></td></tr></table></div>
<p>Then modify the <code>workflow</code> block to connect the <code>ch_samples</code> channel to the <code>FASTP</code> process:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">After</label><label for="__tabbed_9_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-25">25</a></span>
<span class="normal"><a href="#__codelineno-43-26">26</a></span>
<span class="normal"><a href="#__codelineno-43-27">27</a></span>
<span class="normal"><a href="#__codelineno-43-28">28</a></span>
<span class="normal"><a href="#__codelineno-43-29">29</a></span>
<span class="normal"><a href="#__codelineno-43-30">30</a></span>
<span class="normal"><a href="#__codelineno-43-31">31</a></span>
<span class="normal"><a href="#__codelineno-43-32">32</a></span>
<span class="normal"><a href="#__codelineno-43-33">33</a></span>
<span class="normal"><a href="#__codelineno-43-34">34</a></span>
<span class="normal"><a href="#__codelineno-43-35">35</a></span>
<span class="normal"><a href="#__codelineno-43-36">36</a></span>
<span class="normal"><a href="#__codelineno-43-37">37</a></span>
<span class="normal"><a href="#__codelineno-43-38">38</a></span>
<span class="normal"><a href="#__codelineno-43-39">39</a></span>
<span class="normal"><a href="#__codelineno-43-40">40</a></span>
<span class="normal"><a href="#__codelineno-43-41">41</a></span>
<span class="normal"><a href="#__codelineno-43-42">42</a></span>
<span class="normal"><a href="#__codelineno-43-43">43</a></span>
<span class="normal"><a href="#__codelineno-43-44">44</a></span>
<span class="normal"><a href="#__codelineno-43-45">45</a></span>
<span class="normal"><a href="#__codelineno-43-46">46</a></span>
<span class="normal"><a href="#__codelineno-43-47">47</a></span>
<span class="normal"><a href="#__codelineno-43-48">48</a></span>
<span class="normal"><a href="#__codelineno-43-49">49</a></span>
<span class="normal"><a href="#__codelineno-43-50">50</a></span>
<span class="normal"><a href="#__codelineno-43-51">51</a></span>
<span class="normal"><a href="#__codelineno-43-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-25" name="__codelineno-43-25"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-43-26" name="__codelineno-43-26"></a>
<a id="__codelineno-43-27" name="__codelineno-43-27"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-43-28" name="__codelineno-43-28"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-43-29" name="__codelineno-43-29"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-43-30" name="__codelineno-43-30"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-43-31" name="__codelineno-43-31"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-43-32" name="__codelineno-43-32"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-43-33" name="__codelineno-43-33"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-43-34" name="__codelineno-43-34"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-43-35" name="__codelineno-43-35"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-43-36" name="__codelineno-43-36"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-43-37" name="__codelineno-43-37"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
<a id="__codelineno-43-38" name="__codelineno-43-38"></a>
<a id="__codelineno-43-39" name="__codelineno-43-39"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
<a id="__codelineno-43-40" name="__codelineno-43-40"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-43-41" name="__codelineno-43-41"></a><span class="w">                </span><span class="nl">sample_num:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">].</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-43-42" name="__codelineno-43-42"></a><span class="w">                </span><span class="nl">lane:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">],</span>
<a id="__codelineno-43-43" name="__codelineno-43-43"></a><span class="w">                </span><span class="nl">read:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">],</span>
<a id="__codelineno-43-44" name="__codelineno-43-44"></a><span class="w">                </span><span class="nl">chunk:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
<a id="__codelineno-43-45" name="__codelineno-43-45"></a><span class="w">            </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
<a id="__codelineno-43-46" name="__codelineno-43-46"></a>
<a id="__codelineno-43-47" name="__codelineno-43-47"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-43-48" name="__codelineno-43-48"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
<a id="__codelineno-43-49" name="__codelineno-43-49"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-43-50" name="__codelineno-43-50"></a>
<a id="__codelineno-43-51" name="__codelineno-43-51"></a><span class="hll"><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
</span><a id="__codelineno-43-52" name="__codelineno-43-52"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-25">25</a></span>
<span class="normal"><a href="#__codelineno-44-26">26</a></span>
<span class="normal"><a href="#__codelineno-44-27">27</a></span>
<span class="normal"><a href="#__codelineno-44-28">28</a></span>
<span class="normal"><a href="#__codelineno-44-29">29</a></span>
<span class="normal"><a href="#__codelineno-44-30">30</a></span>
<span class="normal"><a href="#__codelineno-44-31">31</a></span>
<span class="normal"><a href="#__codelineno-44-32">32</a></span>
<span class="normal"><a href="#__codelineno-44-33">33</a></span>
<span class="normal"><a href="#__codelineno-44-34">34</a></span>
<span class="normal"><a href="#__codelineno-44-35">35</a></span>
<span class="normal"><a href="#__codelineno-44-36">36</a></span>
<span class="normal"><a href="#__codelineno-44-37">37</a></span>
<span class="normal"><a href="#__codelineno-44-38">38</a></span>
<span class="normal"><a href="#__codelineno-44-39">39</a></span>
<span class="normal"><a href="#__codelineno-44-40">40</a></span>
<span class="normal"><a href="#__codelineno-44-41">41</a></span>
<span class="normal"><a href="#__codelineno-44-42">42</a></span>
<span class="normal"><a href="#__codelineno-44-43">43</a></span>
<span class="normal"><a href="#__codelineno-44-44">44</a></span>
<span class="normal"><a href="#__codelineno-44-45">45</a></span>
<span class="normal"><a href="#__codelineno-44-46">46</a></span>
<span class="normal"><a href="#__codelineno-44-47">47</a></span>
<span class="normal"><a href="#__codelineno-44-48">48</a></span>
<span class="normal"><a href="#__codelineno-44-49">49</a></span>
<span class="normal"><a href="#__codelineno-44-50">50</a></span>
<span class="normal"><a href="#__codelineno-44-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-25" name="__codelineno-44-25"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-26" name="__codelineno-44-26"></a>
<a id="__codelineno-44-27" name="__codelineno-44-27"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-44-28" name="__codelineno-44-28"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-44-29" name="__codelineno-44-29"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-44-30" name="__codelineno-44-30"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-44-31" name="__codelineno-44-31"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-44-32" name="__codelineno-44-32"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-44-33" name="__codelineno-44-33"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-44-34" name="__codelineno-44-34"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-44-35" name="__codelineno-44-35"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-44-36" name="__codelineno-44-36"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-44-37" name="__codelineno-44-37"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
<a id="__codelineno-44-38" name="__codelineno-44-38"></a>
<a id="__codelineno-44-39" name="__codelineno-44-39"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
<a id="__codelineno-44-40" name="__codelineno-44-40"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-44-41" name="__codelineno-44-41"></a><span class="w">                </span><span class="nl">sample_num:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">].</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-44-42" name="__codelineno-44-42"></a><span class="w">                </span><span class="nl">lane:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">],</span>
<a id="__codelineno-44-43" name="__codelineno-44-43"></a><span class="w">                </span><span class="nl">read:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">],</span>
<a id="__codelineno-44-44" name="__codelineno-44-44"></a><span class="w">                </span><span class="nl">chunk:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
<a id="__codelineno-44-45" name="__codelineno-44-45"></a><span class="w">            </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
<a id="__codelineno-44-46" name="__codelineno-44-46"></a>
<a id="__codelineno-44-47" name="__codelineno-44-47"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-44-48" name="__codelineno-44-48"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">[</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)]</span>
<a id="__codelineno-44-49" name="__codelineno-44-49"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-44-50" name="__codelineno-44-50"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</span><a id="__codelineno-44-51" name="__codelineno-44-51"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Run this modified workflow:</p>
<div class="highlight"><span class="filename">Test fastp process</span><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You'll see a long error trace with some content like:</p>
<div class="highlight"><span class="filename">Process error</span><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="go">ERROR ~ Error executing process &gt; &#39;FASTP (3)&#39;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="go">Caused by:</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="go">  Process `FASTP (3)` terminated with an error exit status (255)</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="go">Command executed:</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="go">  fastp \</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="go">      --in1 SAMPLE_003_S3_L001_R1_001.fastq \</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="go">      --in2 null \</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="go">      --out1 sample_003_trimmed_R1.fastq.gz \</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="go">      --out2 sample_003_trimmed_R2.fastq.gz \</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="go">      --json sample_003.fastp.json \</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="go">      --html sample_003.fastp.html \</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="go">      --thread 2</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="go">Command exit status:</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="go">  255</span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="go">Command output:</span>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="go">  (empty)</span>
</code></pre></div>
<p>You can see that the process is trying to run <code>fastp</code> with a <code>null</code> value for the second input file, which is causing it to fail. This is because our dataset contains single-end reads, but the process is hardcoded to expect paired-end reads (two input files at a time).</p>
<p>Fix this by adding conditional logic to the <code>FASTP</code> process <code>script:</code> block. An if/else statement checks read file count and adjusts the command accordingly.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">After</label><label for="__tabbed_10_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span>
<span class="normal"><a href="#__codelineno-47-20">20</a></span>
<span class="normal"><a href="#__codelineno-47-21">21</a></span>
<span class="normal"><a href="#__codelineno-47-22">22</a></span>
<span class="normal"><a href="#__codelineno-47-23">23</a></span>
<span class="normal"><a href="#__codelineno-47-24">24</a></span>
<span class="normal"><a href="#__codelineno-47-25">25</a></span>
<span class="normal"><a href="#__codelineno-47-26">26</a></span>
<span class="normal"><a href="#__codelineno-47-27">27</a></span>
<span class="normal"><a href="#__codelineno-47-28">28</a></span>
<span class="normal"><a href="#__codelineno-47-29">29</a></span>
<span class="normal"><a href="#__codelineno-47-30">30</a></span>
<span class="normal"><a href="#__codelineno-47-31">31</a></span>
<span class="normal"><a href="#__codelineno-47-32">32</a></span>
<span class="normal"><a href="#__codelineno-47-33">33</a></span>
<span class="normal"><a href="#__codelineno-47-34">34</a></span>
<span class="normal"><a href="#__codelineno-47-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="w">    </span><span class="c1">// Simple single-end vs paired-end detection</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">is_single</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">reads</span><span class="o">.</span><span class="na">size</span><span class="o">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
</span><a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="hll">
</span><a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">is_single</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="hll"><span class="w">        </span><span class="kt">def</span><span class="w"> </span><span class="n">input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">reads</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">reads</span>
</span><a id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="hll"><span class="w">        </span><span class="s2">&quot;&quot;&quot;</span>
</span><a id="__codelineno-47-17" name="__codelineno-47-17"></a><span class="hll"><span class="s2">        fastp \\</span>
</span><a id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="hll"><span class="s2">            --in1 ${input_file} \\</span>
</span><a id="__codelineno-47-19" name="__codelineno-47-19"></a><span class="hll"><span class="s2">            --out1 ${meta.id}_trimmed.fastq.gz \\</span>
</span><a id="__codelineno-47-20" name="__codelineno-47-20"></a><span class="hll"><span class="s2">            --json ${meta.id}.fastp.json \\</span>
</span><a id="__codelineno-47-21" name="__codelineno-47-21"></a><span class="hll"><span class="s2">            --html ${meta.id}.fastp.html \\</span>
</span><a id="__codelineno-47-22" name="__codelineno-47-22"></a><span class="hll"><span class="s2">            --thread $task.cpus</span>
</span><a id="__codelineno-47-23" name="__codelineno-47-23"></a><span class="hll"><span class="s2">        &quot;&quot;&quot;</span>
</span><a id="__codelineno-47-24" name="__codelineno-47-24"></a><span class="hll"><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-47-25" name="__codelineno-47-25"></a><span class="hll"><span class="w">        </span><span class="s2">&quot;&quot;&quot;</span>
</span><a id="__codelineno-47-26" name="__codelineno-47-26"></a><span class="hll"><span class="s2">        fastp \\</span>
</span><a id="__codelineno-47-27" name="__codelineno-47-27"></a><span class="hll"><span class="s2">            --in1 ${reads[0]} \\</span>
</span><a id="__codelineno-47-28" name="__codelineno-47-28"></a><span class="hll"><span class="s2">            --in2 ${reads[1]} \\</span>
</span><a id="__codelineno-47-29" name="__codelineno-47-29"></a><span class="hll"><span class="s2">            --out1 ${meta.id}_trimmed_R1.fastq.gz \\</span>
</span><a id="__codelineno-47-30" name="__codelineno-47-30"></a><span class="hll"><span class="s2">            --out2 ${meta.id}_trimmed_R2.fastq.gz \\</span>
</span><a id="__codelineno-47-31" name="__codelineno-47-31"></a><span class="hll"><span class="s2">            --json ${meta.id}.fastp.json \\</span>
</span><a id="__codelineno-47-32" name="__codelineno-47-32"></a><span class="hll"><span class="s2">            --html ${meta.id}.fastp.html \\</span>
</span><a id="__codelineno-47-33" name="__codelineno-47-33"></a><span class="hll"><span class="s2">            --thread $task.cpus</span>
</span><a id="__codelineno-47-34" name="__codelineno-47-34"></a><span class="hll"><span class="s2">        &quot;&quot;&quot;</span>
</span><a id="__codelineno-47-35" name="__codelineno-47-35"></a><span class="hll"><span class="w">    </span><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span>
<span class="normal"><a href="#__codelineno-48-16">16</a></span>
<span class="normal"><a href="#__codelineno-48-17">17</a></span>
<span class="normal"><a href="#__codelineno-48-18">18</a></span>
<span class="normal"><a href="#__codelineno-48-19">19</a></span>
<span class="normal"><a href="#__codelineno-48-20">20</a></span>
<span class="normal"><a href="#__codelineno-48-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="w">        </span><span class="nl">script:</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a><span class="hll"><span class="w">        </span><span class="s2">&quot;&quot;&quot;</span>
</span><a id="__codelineno-48-12" name="__codelineno-48-12"></a><span class="hll"><span class="s2">        fastp \\</span>
</span><a id="__codelineno-48-13" name="__codelineno-48-13"></a><span class="hll"><span class="s2">            --in1 ${reads[0]} \\</span>
</span><a id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="hll"><span class="s2">            --in2 ${reads[1]} \\</span>
</span><a id="__codelineno-48-15" name="__codelineno-48-15"></a><span class="hll"><span class="s2">            --out1 ${meta.id}_trimmed_R1.fastq.gz \\</span>
</span><a id="__codelineno-48-16" name="__codelineno-48-16"></a><span class="hll"><span class="s2">            --out2 ${meta.id}_trimmed_R2.fastq.gz \\</span>
</span><a id="__codelineno-48-17" name="__codelineno-48-17"></a><span class="hll"><span class="s2">            --json ${meta.id}.fastp.json \\</span>
</span><a id="__codelineno-48-18" name="__codelineno-48-18"></a><span class="hll"><span class="s2">            --html ${meta.id}.fastp.html \\</span>
</span><a id="__codelineno-48-19" name="__codelineno-48-19"></a><span class="hll"><span class="s2">            --thread $task.cpus</span>
</span><a id="__codelineno-48-20" name="__codelineno-48-20"></a><span class="hll"><span class="s2">        &quot;&quot;&quot;</span>
</span><a id="__codelineno-48-21" name="__codelineno-48-21"></a><span class="w">    </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Now the workflow can handle both single-end and paired-end reads gracefully. The conditional logic checks the number of input files and constructs the appropriate command for <code>fastp</code>. Let's see if it works:</p>
<div class="highlight"><span class="filename">Test dynamic fastp</span><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<div class="highlight"><span class="filename">Successful run</span><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="go">Launching `main.nf` [adoring_rosalind] DSL2 - revision: 04b1cd93e9</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="go">executor &gt;  local (3)</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="go">[31/a8ad4d] process &gt; FASTP (3) [100%] 3 of 3 ✔</span>
</code></pre></div>
<p>Looks good! If we check the actual commands that were run (customise for your task hash):</p>
<div class="highlight"><span class="filename">Check commands executed</span><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="go">cat work/31/a8ad4d95749e685a6d842d3007957f/.command.sh</span>
</code></pre></div>
<p>We can see that Nextflow correctly picked the right command for single-end reads:</p>
<div class="highlight"><span class="filename">.command.sh</span><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="ch">#!/bin/bash -ue</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>fastp<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">    </span>--in1<span class="w"> </span>SAMPLE_003_S3_L001_R1_001.fastq<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">    </span>--out1<span class="w"> </span>sample_003_trimmed.fastq.gz<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">    </span>--json<span class="w"> </span>sample_003.fastp.json<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span>--html<span class="w"> </span>sample_003.fastp.html<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">    </span>--thread<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>Another common usage of dynamic script logic can be seen in <a href="../../nf4science/genomics/02_joint_calling">the Nextflow for Science Genomics module</a>. In that module, the GATK process being called can take multiple input files, but each must be prefixed with <code>-V</code> to form a correct command line. The process uses scripting to transform a collection of input files (<code>all_gvcfs</code>) into the correct command arguments:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">command line manipulation for GATK</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span>
<span class="normal"><a href="#__codelineno-53-3">3</a></span>
<span class="normal"><a href="#__codelineno-53-4">4</a></span>
<span class="normal"><a href="#__codelineno-53-5">5</a></span>
<span class="normal"><a href="#__codelineno-53-6">6</a></span>
<span class="normal"><a href="#__codelineno-53-7">7</a></span>
<span class="normal"><a href="#__codelineno-53-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">gvcfs_line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_gvcfs</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">gvcf</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;-V ${gvcf}&quot;</span><span class="w"> </span><span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39; &#39;</span><span class="o">)</span>
</span><a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="s2">    gatk GenomicsDBImport \</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="hll"><span class="s2">        ${gvcfs_line} \</span>
</span><a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="s2">        -L ${interval_list} \</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="s2">        --genomicsdb-workspace-path ${cohort_name}_gdb</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
<p>These patterns of using scripting in process script blocks are extremely powerful and can be applied in many scenarios - from handling variable input types to building complex command-line arguments from file collections, making your processes truly adaptable to the diverse requirements of real-world data.</p>
<h3 id="23-variable-interpolation-nextflow-and-shell-variables">2.3. Variable Interpolation: Nextflow and Shell Variables<a class="headerlink" href="#23-variable-interpolation-nextflow-and-shell-variables" title="Permanent link">&para;</a></h3>
<p>Process scripts mix Nextflow variables, shell variables, and command substitutions, each with different interpolation syntax. Using the wrong syntax causes errors. Let's explore these with a process that creates a processing report.</p>
<p>Take a look a the module file <code>modules/generate_report.nf</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/generate_report.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span>
<span class="normal"><a href="#__codelineno-54-11">11</a></span>
<span class="normal"><a href="#__codelineno-54-12">12</a></span>
<span class="normal"><a href="#__codelineno-54-13">13</a></span>
<span class="normal"><a href="#__codelineno-54-14">14</a></span>
<span class="normal"><a href="#__codelineno-54-15">15</a></span>
<span class="normal"><a href="#__codelineno-54-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="n">process</span><span class="w"> </span><span class="n">GENERATE_REPORT</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="w">    </span><span class="n">publishDir</span><span class="w"> </span><span class="s1">&#39;results/reports&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">mode:</span><span class="w"> </span><span class="s1">&#39;copy&#39;</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="w">    </span><span class="nl">output:</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="w">    </span><span class="n">path</span><span class="w"> </span><span class="s2">&quot;${meta.id}_report.txt&quot;</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a><span class="s2">    echo &quot;Processing ${reads}&quot; &gt; ${meta.id}_report.txt</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a><span class="s2">    echo &quot;Sample: ${meta.id}&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-54-15" name="__codelineno-54-15"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-54-16" name="__codelineno-54-16"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
<p>This process writes a simple report with the sample ID and filename. Now let's run it to see what happens when we need to mix different types of variables.</p>
<p>Include the process in your <code>main.nf</code> and add it to the workflow:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">After</label><label for="__tabbed_11_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span>
<span class="normal"><a href="#__codelineno-55-14">14</a></span>
<span class="normal"><a href="#__codelineno-55-15">15</a></span>
<span class="normal"><a href="#__codelineno-55-16">16</a></span>
<span class="normal"><a href="#__codelineno-55-17">17</a></span>
<span class="normal"><a href="#__codelineno-55-18">18</a></span>
<span class="normal"><a href="#__codelineno-55-19">19</a></span>
<span class="normal"><a href="#__codelineno-55-20">20</a></span>
<span class="normal"><a href="#__codelineno-55-21">21</a></span>
<span class="normal"><a href="#__codelineno-55-22">22</a></span>
<span class="normal"><a href="#__codelineno-55-23">23</a></span>
<span class="normal"><a href="#__codelineno-55-24">24</a></span>
<span class="normal"><a href="#__codelineno-55-25">25</a></span>
<span class="normal"><a href="#__codelineno-55-26">26</a></span>
<span class="normal"><a href="#__codelineno-55-27">27</a></span>
<span class="normal"><a href="#__codelineno-55-28">28</a></span>
<span class="normal"><a href="#__codelineno-55-29">29</a></span>
<span class="normal"><a href="#__codelineno-55-30">30</a></span>
<span class="normal"><a href="#__codelineno-55-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="hll"><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">GENERATE_REPORT</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/generate_report.nf&#39;</span>
</span><a id="__codelineno-55-3" name="__codelineno-55-3"></a>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a><span class="w">            </span><span class="o">]</span>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a>
<a id="__codelineno-55-17" name="__codelineno-55-17"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
<a id="__codelineno-55-18" name="__codelineno-55-18"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-55-19" name="__codelineno-55-19"></a><span class="w">                </span><span class="nl">sample_num:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">].</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-55-20" name="__codelineno-55-20"></a><span class="w">                </span><span class="nl">lane:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">],</span>
<a id="__codelineno-55-21" name="__codelineno-55-21"></a><span class="w">                </span><span class="nl">read:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">],</span>
<a id="__codelineno-55-22" name="__codelineno-55-22"></a><span class="w">                </span><span class="nl">chunk:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
<a id="__codelineno-55-23" name="__codelineno-55-23"></a><span class="w">            </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
<a id="__codelineno-55-24" name="__codelineno-55-24"></a>
<a id="__codelineno-55-25" name="__codelineno-55-25"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-55-26" name="__codelineno-55-26"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
<a id="__codelineno-55-27" name="__codelineno-55-27"></a><span class="w">        </span><span class="o">}</span>
<a id="__codelineno-55-28" name="__codelineno-55-28"></a>
<a id="__codelineno-55-29" name="__codelineno-55-29"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-55-30" name="__codelineno-55-30"></a><span class="hll"><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
</span><a id="__codelineno-55-31" name="__codelineno-55-31"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span>
<span class="normal"><a href="#__codelineno-56-14">14</a></span>
<span class="normal"><a href="#__codelineno-56-15">15</a></span>
<span class="normal"><a href="#__codelineno-56-16">16</a></span>
<span class="normal"><a href="#__codelineno-56-17">17</a></span>
<span class="normal"><a href="#__codelineno-56-18">18</a></span>
<span class="normal"><a href="#__codelineno-56-19">19</a></span>
<span class="normal"><a href="#__codelineno-56-20">20</a></span>
<span class="normal"><a href="#__codelineno-56-21">21</a></span>
<span class="normal"><a href="#__codelineno-56-22">22</a></span>
<span class="normal"><a href="#__codelineno-56-23">23</a></span>
<span class="normal"><a href="#__codelineno-56-24">24</a></span>
<span class="normal"><a href="#__codelineno-56-25">25</a></span>
<span class="normal"><a href="#__codelineno-56-26">26</a></span>
<span class="normal"><a href="#__codelineno-56-27">27</a></span>
<span class="normal"><a href="#__codelineno-56-28">28</a></span>
<span class="normal"><a href="#__codelineno-56-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="hll"><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
</span><a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="hll"><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
</span><a id="__codelineno-56-11" name="__codelineno-56-11"></a><span class="hll"><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-56-12" name="__codelineno-56-12"></a><span class="hll"><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
</span><a id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="hll"><span class="w">            </span><span class="o">]</span>
</span><a id="__codelineno-56-14" name="__codelineno-56-14"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
</span><a id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="hll">
</span><a id="__codelineno-56-16" name="__codelineno-56-16"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
</span><a id="__codelineno-56-17" name="__codelineno-56-17"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span>
</span><a id="__codelineno-56-18" name="__codelineno-56-18"></a><span class="hll"><span class="w">                </span><span class="nl">sample_num:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">].</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-56-19" name="__codelineno-56-19"></a><span class="hll"><span class="w">                </span><span class="nl">lane:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">],</span>
</span><a id="__codelineno-56-20" name="__codelineno-56-20"></a><span class="hll"><span class="w">                </span><span class="nl">read:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">],</span>
</span><a id="__codelineno-56-21" name="__codelineno-56-21"></a><span class="hll"><span class="w">                </span><span class="nl">chunk:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
</span><a id="__codelineno-56-22" name="__codelineno-56-22"></a><span class="hll"><span class="w">            </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
</span><a id="__codelineno-56-23" name="__codelineno-56-23"></a><span class="hll">
</span><a id="__codelineno-56-24" name="__codelineno-56-24"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-56-25" name="__codelineno-56-25"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
</span><a id="__codelineno-56-26" name="__codelineno-56-26"></a><span class="hll"><span class="w">        </span><span class="o">}</span>
</span><a id="__codelineno-56-27" name="__codelineno-56-27"></a><span class="hll">
</span><a id="__codelineno-56-28" name="__codelineno-56-28"></a><span class="hll"><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
</span><a id="__codelineno-56-29" name="__codelineno-56-29"></a><span class="hll"><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Now run the workflow and check the generated reports in <code>results/reports/</code>. They should contain basic information about each sample.</p>
<p>But what if we want to add information about when and where the processing occurred? Let's modify the process to use <strong>shell</strong> variables and a bit of command substitution to include the current user, hostname, and date in the report:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">After</label><label for="__tabbed_12_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/generate_report.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="s2">    echo &quot;Processing ${reads}&quot; &gt; ${meta.id}_report.txt</span>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a><span class="s2">    echo &quot;Sample: ${meta.id}&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="hll"><span class="s2">    echo &quot;Processed by: ${USER}&quot; &gt;&gt; ${meta.id}_report.txt</span>
</span><a id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="hll"><span class="s2">    echo &quot;Hostname: $(hostname)&quot; &gt;&gt; ${meta.id}_report.txt</span>
</span><a id="__codelineno-57-16" name="__codelineno-57-16"></a><span class="hll"><span class="s2">    echo &quot;Date: $(date)&quot; &gt;&gt; ${meta.id}_report.txt</span>
</span><a id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/generate_report.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="s2">    echo &quot;Processing ${reads}&quot; &gt; ${meta.id}_report.txt</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="s2">    echo &quot;Sample: ${meta.id}&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>If you run this, you'll notice an error or unexpected behavior - Nextflow tries to interpret <code>$(hostname)</code> as a Nextflow variable that doesn't exist:</p>
<div class="highlight"><span class="filename">Error with shell variables</span><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="go">unknown recognition error type: groovyjarjarantlr4.v4.runtime.LexerNoViableAltException</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="go">ERROR ~ Module compilation error</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="go">- file : /workspaces/training/side-quests/essential_scripting_patterns/modules/generate_report.nf</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="go">- cause: token recognition error at: &#39;(&#39; @ line 16, column 22.</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="go">       echo &quot;Hostname: $(hostname)&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="go">                        ^</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="go">1 error</span>
</code></pre></div>
<p>We need to escape it so Bash can handle it instead.</p>
<p>Fix this by escaping the shell variables and command substitutions with a backslash (<code>\</code>):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">After</label><label for="__tabbed_13_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/generate_report.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-10">10</a></span>
<span class="normal"><a href="#__codelineno-60-11">11</a></span>
<span class="normal"><a href="#__codelineno-60-12">12</a></span>
<span class="normal"><a href="#__codelineno-60-13">13</a></span>
<span class="normal"><a href="#__codelineno-60-14">14</a></span>
<span class="normal"><a href="#__codelineno-60-15">15</a></span>
<span class="normal"><a href="#__codelineno-60-16">16</a></span>
<span class="normal"><a href="#__codelineno-60-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-10" name="__codelineno-60-10"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a><span class="s2">    echo &quot;Processing ${reads}&quot; &gt; ${meta.id}_report.txt</span>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a><span class="s2">    echo &quot;Sample: ${meta.id}&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a><span class="hll"><span class="s2">    echo &quot;Processed by: \${USER}&quot; &gt;&gt; ${meta.id}_report.txt</span>
</span><a id="__codelineno-60-15" name="__codelineno-60-15"></a><span class="hll"><span class="s2">    echo &quot;Hostname: \$(hostname)&quot; &gt;&gt; ${meta.id}_report.txt</span>
</span><a id="__codelineno-60-16" name="__codelineno-60-16"></a><span class="hll"><span class="s2">    echo &quot;Date: \$(date)&quot; &gt;&gt; ${meta.id}_report.txt</span>
</span><a id="__codelineno-60-17" name="__codelineno-60-17"></a><span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/generate_report.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="w">    </span><span class="nl">script:</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="s2">    echo &quot;Processing ${reads}&quot; &gt; ${meta.id}_report.txt</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="s2">    echo &quot;Sample: ${meta.id}&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="s2">    echo &quot;Processed by: ${USER}&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a><span class="s2">    echo &quot;Hostname: $(hostname)&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="s2">    echo &quot;Date: $(date)&quot; &gt;&gt; ${meta.id}_report.txt</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a><span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Now it works! The backslash (<code>\</code>) tells Nextflow "don't interpret this, pass it through to Bash."</p>
<h3 id="takeaway_1">Takeaway<a class="headerlink" href="#takeaway_1" title="Permanent link">&para;</a></h3>
<p>In this section, you've learned <strong>string processing</strong> techniques:</p>
<ul>
<li><strong>Regular expressions for file parsing</strong>: Using the <code>=~</code> operator and regex patterns (<code>~/pattern/</code>) to extract metadata from complex file naming conventions</li>
<li><strong>Dynamic script generation</strong>: Using conditional logic (if/else, ternary operators) to generate different script strings based on input characteristics</li>
<li><strong>Variable interpolation</strong>: Understanding when Nextflow interprets strings vs when the shell does</li>
<li><code>${var}</code> - Nextflow variables (interpolated by Nextflow at workflow compile time)</li>
<li><code>\${var}</code> - Shell environment variables (escaped, passed to bash at runtime)</li>
<li><code>\$(cmd)</code> - Shell command substitution (escaped, executed by bash at runtime)</li>
</ul>
<p>These string processing and generation patterns are essential for handling the diverse file formats and naming conventions you'll encounter in real-world bioinformatics workflows.</p>
<hr />
<h2 id="3-creating-reusable-functions">3. Creating Reusable Functions<a class="headerlink" href="#3-creating-reusable-functions" title="Permanent link">&para;</a></h2>
<p>Complex workflow logic inline in channel operators or process definitions reduces readability and maintainability. <strong>Functions</strong> let you extract this logic into named, reusable components.</p>
<p>Our map operation has grown long and complex. Let's extract it into a reusable function using the <code>def</code> keyword.</p>
<p>To illustrate what that looks like with our existing workflow, make the modification below, using <code>def</code> to define a reusable function called <code>separateMetadata</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">After</label><label for="__tabbed_14_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span>
<span class="normal"><a href="#__codelineno-62-15">15</a></span>
<span class="normal"><a href="#__codelineno-62-16">16</a></span>
<span class="normal"><a href="#__codelineno-62-17">17</a></span>
<span class="normal"><a href="#__codelineno-62-18">18</a></span>
<span class="normal"><a href="#__codelineno-62-19">19</a></span>
<span class="normal"><a href="#__codelineno-62-20">20</a></span>
<span class="normal"><a href="#__codelineno-62-21">21</a></span>
<span class="normal"><a href="#__codelineno-62-22">22</a></span>
<span class="normal"><a href="#__codelineno-62-23">23</a></span>
<span class="normal"><a href="#__codelineno-62-24">24</a></span>
<span class="normal"><a href="#__codelineno-62-25">25</a></span>
<span class="normal"><a href="#__codelineno-62-26">26</a></span>
<span class="normal"><a href="#__codelineno-62-27">27</a></span>
<span class="normal"><a href="#__codelineno-62-28">28</a></span>
<span class="normal"><a href="#__codelineno-62-29">29</a></span>
<span class="normal"><a href="#__codelineno-62-30">30</a></span>
<span class="normal"><a href="#__codelineno-62-31">31</a></span>
<span class="normal"><a href="#__codelineno-62-32">32</a></span>
<span class="normal"><a href="#__codelineno-62-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">GENERATE_REPORT</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/generate_report.nf&#39;</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="hll"><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
</span><a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="hll"><span class="w">        </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
</span><a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="hll"><span class="w">        </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
</span><a id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="hll"><span class="w">        </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
</span><a id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="hll"><span class="w">        </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-62-10" name="__codelineno-62-10"></a><span class="hll"><span class="w">        </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
</span><a id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="hll"><span class="w">    </span><span class="o">]</span>
</span><a id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
</span><a id="__codelineno-62-13" name="__codelineno-62-13"></a><span class="hll">
</span><a id="__codelineno-62-14" name="__codelineno-62-14"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
</span><a id="__codelineno-62-15" name="__codelineno-62-15"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span>
</span><a id="__codelineno-62-16" name="__codelineno-62-16"></a><span class="hll"><span class="w">        </span><span class="nl">sample_num:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">].</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-62-17" name="__codelineno-62-17"></a><span class="hll"><span class="w">        </span><span class="nl">lane:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">],</span>
</span><a id="__codelineno-62-18" name="__codelineno-62-18"></a><span class="hll"><span class="w">        </span><span class="nl">read:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">],</span>
</span><a id="__codelineno-62-19" name="__codelineno-62-19"></a><span class="hll"><span class="w">        </span><span class="nl">chunk:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
</span><a id="__codelineno-62-20" name="__codelineno-62-20"></a><span class="hll"><span class="w">    </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
</span><a id="__codelineno-62-21" name="__codelineno-62-21"></a><span class="hll">
</span><a id="__codelineno-62-22" name="__codelineno-62-22"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-62-23" name="__codelineno-62-23"></a><span class="hll"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
</span><a id="__codelineno-62-24" name="__codelineno-62-24"></a><span class="hll"><span class="o">}</span>
</span><a id="__codelineno-62-25" name="__codelineno-62-25"></a>
<a id="__codelineno-62-26" name="__codelineno-62-26"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-62-27" name="__codelineno-62-27"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-62-28" name="__codelineno-62-28"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-62-29" name="__codelineno-62-29"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">}</span>
</span><a id="__codelineno-62-30" name="__codelineno-62-30"></a>
<a id="__codelineno-62-31" name="__codelineno-62-31"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-62-32" name="__codelineno-62-32"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-62-33" name="__codelineno-62-33"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span>
<span class="normal"><a href="#__codelineno-63-14">14</a></span>
<span class="normal"><a href="#__codelineno-63-15">15</a></span>
<span class="normal"><a href="#__codelineno-63-16">16</a></span>
<span class="normal"><a href="#__codelineno-63-17">17</a></span>
<span class="normal"><a href="#__codelineno-63-18">18</a></span>
<span class="normal"><a href="#__codelineno-63-19">19</a></span>
<span class="normal"><a href="#__codelineno-63-20">20</a></span>
<span class="normal"><a href="#__codelineno-63-21">21</a></span>
<span class="normal"><a href="#__codelineno-63-22">22</a></span>
<span class="normal"><a href="#__codelineno-63-23">23</a></span>
<span class="normal"><a href="#__codelineno-63-24">24</a></span>
<span class="normal"><a href="#__codelineno-63-25">25</a></span>
<span class="normal"><a href="#__codelineno-63-26">26</a></span>
<span class="normal"><a href="#__codelineno-63-27">27</a></span>
<span class="normal"><a href="#__codelineno-63-28">28</a></span>
<span class="normal"><a href="#__codelineno-63-29">29</a></span>
<span class="normal"><a href="#__codelineno-63-30">30</a></span>
<span class="normal"><a href="#__codelineno-63-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">GENERATE_REPORT</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/generate_report.nf&#39;</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span>
</span><a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
</span><a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="hll"><span class="w">                </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
</span><a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="hll"><span class="w">                </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
</span><a id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="hll"><span class="w">                </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
</span><a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="hll"><span class="w">                </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-63-13" name="__codelineno-63-13"></a><span class="hll"><span class="w">                </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
</span><a id="__codelineno-63-14" name="__codelineno-63-14"></a><span class="hll"><span class="w">            </span><span class="o">]</span>
</span><a id="__codelineno-63-15" name="__codelineno-63-15"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
</span><a id="__codelineno-63-16" name="__codelineno-63-16"></a><span class="hll">
</span><a id="__codelineno-63-17" name="__codelineno-63-17"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
</span><a id="__codelineno-63-18" name="__codelineno-63-18"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span>
</span><a id="__codelineno-63-19" name="__codelineno-63-19"></a><span class="hll"><span class="w">                </span><span class="nl">sample_num:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">].</span><span class="na">toInteger</span><span class="o">(),</span>
</span><a id="__codelineno-63-20" name="__codelineno-63-20"></a><span class="hll"><span class="w">                </span><span class="nl">lane:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">3</span><span class="o">],</span>
</span><a id="__codelineno-63-21" name="__codelineno-63-21"></a><span class="hll"><span class="w">                </span><span class="nl">read:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">4</span><span class="o">],</span>
</span><a id="__codelineno-63-22" name="__codelineno-63-22"></a><span class="hll"><span class="w">                </span><span class="nl">chunk:</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">5</span><span class="o">]</span>
</span><a id="__codelineno-63-23" name="__codelineno-63-23"></a><span class="hll"><span class="w">            </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
</span><a id="__codelineno-63-24" name="__codelineno-63-24"></a><span class="hll">
</span><a id="__codelineno-63-25" name="__codelineno-63-25"></a><span class="hll"><span class="w">            </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
</span><a id="__codelineno-63-26" name="__codelineno-63-26"></a><span class="hll"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
</span><a id="__codelineno-63-27" name="__codelineno-63-27"></a><span class="hll"><span class="w">        </span><span class="o">}</span>
</span><a id="__codelineno-63-28" name="__codelineno-63-28"></a>
<a id="__codelineno-63-29" name="__codelineno-63-29"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-63-30" name="__codelineno-63-30"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-63-31" name="__codelineno-63-31"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>By extracting this logic into a function, we've reduced the actual workflow logic down to something much cleaner:</p>
<div class="highlight"><span class="filename">minimal workflow</span><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
</code></pre></div>
<p>This makes the workflow logic much easier to read and understand at a glance. The function <code>separateMetadata</code> encapsulates all the complex logic for parsing and enriching metadata, making it reusable and testable.</p>
<p>Run the workflow to make sure it still works:</p>
<div class="highlight"><span class="filename">Test reusable function</span><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<div class="highlight"><span class="filename">Function results</span><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="go">Launching `main.nf` [admiring_panini] DSL2 - revision: 8cc832e32f</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="go">executor &gt;  local (6)</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="go">[8c/2e3f91] process &gt; FASTP (3)           [100%] 3 of 3 ✔</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="go">[7a/1b4c92] process &gt; GENERATE_REPORT (3) [100%] 3 of 3 ✔</span>
</code></pre></div>
<p>The output should show both processes completing successfully. The workflow is now much cleaner and easier to maintain, with all the complex metadata processing logic encapsulated in the <code>separateMetadata</code> function.</p>
<h3 id="takeaway_2">Takeaway<a class="headerlink" href="#takeaway_2" title="Permanent link">&para;</a></h3>
<p>In this section, you've learned <strong>function creation</strong>:</p>
<ul>
<li><strong>Defining functions with <code>def</code></strong>: The keyword for creating named functions (like <code>def</code> in Python or <code>function</code> in JavaScript)</li>
<li><strong>Function scope</strong>: Functions defined at the script level are accessible throughout your Nextflow workflow</li>
<li><strong>Return values</strong>: Functions automatically return the last expression, or use explicit <code>return</code></li>
<li><strong>Cleaner code</strong>: Extracting complex logic into functions is a fundamental software engineering practice in any language</li>
</ul>
<p>Next, we'll explore how to use closures in process directives for dynamic resource allocation.</p>
<hr />
<h2 id="4-dynamic-resource-directives-with-closures">4. Dynamic Resource Directives with Closures<a class="headerlink" href="#4-dynamic-resource-directives-with-closures" title="Permanent link">&para;</a></h2>
<p>So far we've used scripting in the <code>script</code> block of processes. But <strong>closures</strong> (introduced in Section 1.1) are also incredibly useful in process directives, especially for dynamic resource allocation. Let's add resource directives to our FASTP process that adapt based on the sample characteristics.</p>
<p>Currently, our FASTP process uses default resources. Let's make it smarter by allocating more CPUs for high-depth samples. Edit <code>modules/fastp.nf</code> to include a dynamic <code>cpus</code> directive and a static <code>memory</code> directive:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">After</label><label for="__tabbed_15_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/fastp.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span>
<span class="normal"><a href="#__codelineno-67-4">4</a></span>
<span class="normal"><a href="#__codelineno-67-5">5</a></span>
<span class="normal"><a href="#__codelineno-67-6">6</a></span>
<span class="normal"><a href="#__codelineno-67-7">7</a></span>
<span class="normal"><a href="#__codelineno-67-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s1">&#39;community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690&#39;</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="hll"><span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40000000</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">}</span>
</span><a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="hll"><span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span><span class="na">GB</span>
</span><a id="__codelineno-67-6" name="__codelineno-67-6"></a>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/fastp.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span>
<span class="normal"><a href="#__codelineno-68-2">2</a></span>
<span class="normal"><a href="#__codelineno-68-3">3</a></span>
<span class="normal"><a href="#__codelineno-68-4">4</a></span>
<span class="normal"><a href="#__codelineno-68-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s1">&#39;community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690&#39;</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>The closure <code>{ meta.depth &gt; 40000000 ? 2 : 1 }</code> uses the <strong>ternary operator</strong> (covered in Section 1.1) and is evaluated for each task, allowing per-sample resource allocation. High-depth samples (&gt;40M reads) get 2 CPUs, while others get 1 CPU.</p>
<div class="admonition note">
<p class="admonition-title">Accessing Input Variables in Directives</p>
<p>The closure can access any input variables (like <code>meta</code> here) because Nextflow evaluates these closures in the context of each task execution.</p>
</div>
<p>Run the workflow again:</p>
<div class="highlight"><span class="filename">Test resource allocation</span><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>-ansi-log<span class="w"> </span><span class="nb">false</span>
</code></pre></div>
<p>We're using the <code>-ansi-log false</code> option to make it easier to see the task hashes.</p>
<div class="highlight"><span class="filename">Resource allocation output</span><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="go">N E X T F L O W  ~  version 25.04.3</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="go">Launching `main.nf` [fervent_albattani] DSL2 - revision: fa8f249759</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="go">[bd/ff3d41] Submitted process &gt; FASTP (2)</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="go">[a4/a3aab2] Submitted process &gt; FASTP (1)</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="go">[48/6db0c9] Submitted process &gt; FASTP (3)</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="go">[ec/83439d] Submitted process &gt; GENERATE_REPORT (3)</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="go">[bd/15d7cc] Submitted process &gt; GENERATE_REPORT (2)</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="go">[42/699357] Submitted process &gt; GENERATE_REPORT (1)</span>
</code></pre></div>
<p>You can check the exact <code>docker</code> command that was run to see the CPU allocation for any given task:</p>
<div class="highlight"><span class="filename">Check docker command</span><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="go">cat work/48/6db0c9e9d8aa65e4bb4936cd3bd59e/.command.run | grep &quot;docker run&quot;</span>
</code></pre></div>
<p>You should see something like:</p>
<div class="highlight"><span class="filename">docker command</span><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="w">    </span>docker<span class="w"> </span>run<span class="w"> </span>-i<span class="w"> </span>--cpu-shares<span class="w"> </span><span class="m">4096</span><span class="w"> </span>--memory<span class="w"> </span>2048m<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;NXF_TASK_WORKDIR&quot;</span><span class="w"> </span>-v<span class="w"> </span>/workspaces/training/side-quests/essential_scripting_patterns:/workspaces/training/side-quests/essential_scripting_patterns<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$NXF_TASK_WORKDIR</span><span class="s2">&quot;</span><span class="w"> </span>--name<span class="w"> </span><span class="nv">$NXF_BOXID</span><span class="w"> </span>community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690<span class="w"> </span>/bin/bash<span class="w"> </span>-ue<span class="w"> </span>/workspaces/training/side-quests/essential_scripting_patterns/work/48/6db0c9e9d8aa65e4bb4936cd3bd59e/.command.sh
</code></pre></div>
<p>In this example we've chosen an example that requested 2 CPUs (<code>--cpu-shares 2048</code>), because it was a high-depth sample, but you should see different CPU allocations depending on the sample depth. Try this for the other tasks as well.</p>
<p>Another powerful pattern is using <code>task.attempt</code> for retry strategies. To show why this is useful, we're going to start by reducing the memory allocation to FASTP to less than it needs. Change the <code>memory</code> directive in <code>modules/fastp.nf</code> to <code>1.GB</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:2"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><input id="__tabbed_16_2" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">After</label><label for="__tabbed_16_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/fastp.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span>
<span class="normal"><a href="#__codelineno-73-2">2</a></span>
<span class="normal"><a href="#__codelineno-73-3">3</a></span>
<span class="normal"><a href="#__codelineno-73-4">4</a></span>
<span class="normal"><a href="#__codelineno-73-5">5</a></span>
<span class="normal"><a href="#__codelineno-73-6">6</a></span>
<span class="normal"><a href="#__codelineno-73-7">7</a></span>
<span class="normal"><a href="#__codelineno-73-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s1">&#39;community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690&#39;</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40000000</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="hll"><span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span><span class="na">GB</span>
</span><a id="__codelineno-73-6" name="__codelineno-73-6"></a>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/fastp.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span>
<span class="normal"><a href="#__codelineno-74-2">2</a></span>
<span class="normal"><a href="#__codelineno-74-3">3</a></span>
<span class="normal"><a href="#__codelineno-74-4">4</a></span>
<span class="normal"><a href="#__codelineno-74-5">5</a></span>
<span class="normal"><a href="#__codelineno-74-6">6</a></span>
<span class="normal"><a href="#__codelineno-74-7">7</a></span>
<span class="normal"><a href="#__codelineno-74-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s1">&#39;community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690&#39;</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40000000</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="hll"><span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span><span class="na">GB</span>
</span><a id="__codelineno-74-6" name="__codelineno-74-6"></a>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>... and run the workflow again:</p>
<div class="highlight"><span class="filename">Test insufficient memory</span><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You'll see an error indicating that the process was killed for exceeding memory limits:</p>
<div class="highlight"><span class="filename">Memory error output</span><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="go">Command exit status:</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="hll"><span class="go">  137</span>
</span><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="go">Command output:</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="go">  (empty)</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="go">Command error:</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="go">  Detecting adapter sequence for read1...</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="go">  No adapter detected for read1</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="hll"><span class="go">  .command.sh: line 7:   101 Killed                  fastp --in1 SAMPLE_002_S2_L001_R1_001.fastq --out1 sample_002_trimmed.fastq.gz --json sample_002.fastp.json --html sample_002.fastp.html --thread 2</span>
</span></code></pre></div>
<p>This is a very common scenario in real-world workflows - sometimes you just don't know how much memory a task will need until you run it. To make our workflow more robust, we can implement a retry strategy that increases memory allocation on each attempt, once again using a Groovy closure. Modify the <code>memory</code> directive to multiply the base memory by <code>task.attempt</code>, and add <code>errorStrategy 'retry'</code> and <code>maxRetries 2</code> directives:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">After</label><label for="__tabbed_17_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/fastp.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-77-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-77-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-77-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-77-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-77-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-77-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-77-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-77-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-77-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s1">&#39;community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690&#39;</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40000000</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a><span class="hll"><span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="mi">1</span><span class="o">.</span><span class="na">GB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">task</span><span class="o">.</span><span class="na">attempt</span><span class="w"> </span><span class="o">}</span>
</span><a id="__codelineno-77-6" name="__codelineno-77-6"></a><span class="hll"><span class="w">    </span><span class="n">errorStrategy</span><span class="w"> </span><span class="s1">&#39;retry&#39;</span>
</span><a id="__codelineno-77-7" name="__codelineno-77-7"></a><span class="hll"><span class="w">    </span><span class="n">maxRetries</span><span class="w"> </span><span class="mi">2</span>
</span><a id="__codelineno-77-8" name="__codelineno-77-8"></a>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">modules/fastp.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span>
<span class="normal"><a href="#__codelineno-78-3">3</a></span>
<span class="normal"><a href="#__codelineno-78-4">4</a></span>
<span class="normal"><a href="#__codelineno-78-5">5</a></span>
<span class="normal"><a href="#__codelineno-78-6">6</a></span>
<span class="normal"><a href="#__codelineno-78-7">7</a></span>
<span class="normal"><a href="#__codelineno-78-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="n">process</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="s1">&#39;community.wave.seqera.io/library/fastp:0.24.0--62c97b06e8447690&#39;</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40000000</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a><span class="hll"><span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="mi">2</span><span class="o">.</span><span class="na">GB</span>
</span><a id="__codelineno-78-6" name="__codelineno-78-6"></a>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a><span class="w">    </span><span class="nl">input:</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">reads</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Now if the process fails due to insufficient memory, Nextflow will retry with more memory:</p>
<ul>
<li>First attempt: 1 GB (task.attempt = 1)</li>
<li>Second attempt: 2.GB (task.attempt = 2)</li>
</ul>
<p>... and so on, up to the <code>maxRetries</code> limit.</p>
<h3 id="takeaway_3">Takeaway<a class="headerlink" href="#takeaway_3" title="Permanent link">&para;</a></h3>
<p>Dynamic directives with closures let you:</p>
<ul>
<li>Allocate resources based on input characteristics</li>
<li>Implement automatic retry strategies with increasing resources</li>
<li>Combine multiple factors (metadata, attempt number, priorities)</li>
<li>Use conditional logic for complex resource calculations</li>
</ul>
<p>This makes your workflows both more efficient (not over-allocating) and more robust (automatic retry with more resources).</p>
<hr />
<h2 id="5-conditional-logic-and-process-control">5. Conditional Logic and Process Control<a class="headerlink" href="#5-conditional-logic-and-process-control" title="Permanent link">&para;</a></h2>
<p>Previously, we used <code>.map()</code> with scripting to transform channel data. Now we'll use conditional logic to control which processes execute based on data—essential for flexible workflows adapting to different sample types.</p>
<p>Nextflow's <a href="https://www.nextflow.io/docs/latest/reference/operator.html">dataflow operators</a> take closures evaluated at runtime, enabling conditional logic to drive workflow decisions based on channel content.</p>
<h3 id="51-routing-with-branch">5.1. Routing with <code>.branch()</code><a class="headerlink" href="#51-routing-with-branch" title="Permanent link">&para;</a></h3>
<p>For example, let's pretend that our sequencing samples need to be trimmed with FASTP only if they're human samples with a coverage above a certain threshold. Mouse samples or low-coverage samples should be run with Trimgalore instead (this is a contrived example, but it illustrates the point).</p>
<p>We've provided a simple Trimgalore process in <code>modules/trimgalore.nf</code>, take a look if you like, but the details aren't important for this exercise. The key point is that we want to route samples based on their metadata.</p>
<p>Include the new from in <code>modules/trimgalore.nf</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">After</label><label for="__tabbed_18_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="hll"><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/trimgalore.nf&#39;</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>... and then modify your <code>main.nf</code> workflow to branch samples based on their metadata and route them through the appropriate trimming process, like this:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:2"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><input id="__tabbed_19_2" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">After</label><label for="__tabbed_19_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-28">28</a></span>
<span class="normal"><a href="#__codelineno-81-29">29</a></span>
<span class="normal"><a href="#__codelineno-81-30">30</a></span>
<span class="normal"><a href="#__codelineno-81-31">31</a></span>
<span class="normal"><a href="#__codelineno-81-32">32</a></span>
<span class="normal"><a href="#__codelineno-81-33">33</a></span>
<span class="normal"><a href="#__codelineno-81-34">34</a></span>
<span class="normal"><a href="#__codelineno-81-35">35</a></span>
<span class="normal"><a href="#__codelineno-81-36">36</a></span>
<span class="normal"><a href="#__codelineno-81-37">37</a></span>
<span class="normal"><a href="#__codelineno-81-38">38</a></span>
<span class="normal"><a href="#__codelineno-81-39">39</a></span>
<span class="normal"><a href="#__codelineno-81-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-28" name="__codelineno-81-28"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-81-29" name="__codelineno-81-29"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-81-30" name="__codelineno-81-30"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">separateMetadata</span><span class="o">)</span>
<a id="__codelineno-81-31" name="__codelineno-81-31"></a>
<a id="__codelineno-81-32" name="__codelineno-81-32"></a><span class="hll"><span class="w">    </span><span class="n">trim_branches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_samples</span>
</span><a id="__codelineno-81-33" name="__codelineno-81-33"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">branch</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">,</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="o">-&gt;</span>
</span><a id="__codelineno-81-34" name="__codelineno-81-34"></a><span class="hll"><span class="w">            </span><span class="nl">fastp:</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;human&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">30000000</span>
</span><a id="__codelineno-81-35" name="__codelineno-81-35"></a><span class="hll"><span class="w">            </span><span class="nl">trimgalore:</span><span class="w"> </span><span class="kc">true</span>
</span><a id="__codelineno-81-36" name="__codelineno-81-36"></a><span class="hll"><span class="w">        </span><span class="o">}</span>
</span><a id="__codelineno-81-37" name="__codelineno-81-37"></a><span class="hll">
</span><a id="__codelineno-81-38" name="__codelineno-81-38"></a><span class="hll"><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">fastp</span><span class="o">)</span>
</span><a id="__codelineno-81-39" name="__codelineno-81-39"></a><span class="hll"><span class="w">    </span><span class="n">ch_trimgalore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">trimgalore</span><span class="o">)</span>
</span><a id="__codelineno-81-40" name="__codelineno-81-40"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-28">28</a></span>
<span class="normal"><a href="#__codelineno-82-29">29</a></span>
<span class="normal"><a href="#__codelineno-82-30">30</a></span>
<span class="normal"><a href="#__codelineno-82-31">31</a></span>
<span class="normal"><a href="#__codelineno-82-32">32</a></span>
<span class="normal"><a href="#__codelineno-82-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-28" name="__codelineno-82-28"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-82-29" name="__codelineno-82-29"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-82-30" name="__codelineno-82-30"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">separateMetadata</span><span class="o">)</span>
<a id="__codelineno-82-31" name="__codelineno-82-31"></a>
<a id="__codelineno-82-32" name="__codelineno-82-32"></a><span class="hll"><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
</span><a id="__codelineno-82-33" name="__codelineno-82-33"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Run this modified workflow:</p>
<div class="highlight"><span class="filename">Test conditional trimming</span><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<div class="highlight"><span class="filename">Conditional trimming results</span><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="go">Launching `main.nf` [adoring_galileo] DSL2 - revision: c9e83aaef1</span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="go">executor &gt;  local (6)</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="go">[1d/0747ac] process &gt; FASTP (2)           [100%] 2 of 2 ✔</span>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="go">[cc/c44caf] process &gt; TRIMGALORE (1)      [100%] 1 of 1 ✔</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="go">[34/bd5a9f] process &gt; GENERATE_REPORT (1) [100%] 3 of 3 ✔</span>
</code></pre></div>
<p>Here, we've used small but mighty conditional expressions inside the <code>.branch{}</code> operator to route samples based on their metadata. Human samples with high coverage go through <code>FASTP</code>, while all other samples go through <code>TRIMGALORE</code>.</p>
<h3 id="52-using-filter-with-truthiness">5.2. Using <code>.filter()</code> with Truthiness<a class="headerlink" href="#52-using-filter-with-truthiness" title="Permanent link">&para;</a></h3>
<p>Another powerful pattern for controlling workflow execution is the <code>.filter()</code> operator, which uses a closure to determine which items should continue down the pipeline. Inside the filter closure, you'll write <strong>boolean expressions</strong> that decide which items pass through.</p>
<p>Nextflow (like many dynamic languages) has a concept of <strong>"truthiness"</strong> that determines what values evaluate to <code>true</code> or <code>false</code> in boolean contexts:</p>
<ul>
<li><strong>Truthy</strong>: Non-null values, non-empty strings, non-zero numbers, non-empty collections</li>
<li><strong>Falsy</strong>: <code>null</code>, empty strings <code>""</code>, zero <code>0</code>, empty collections <code>[]</code> or <code>[:]</code>, <code>false</code></li>
</ul>
<p>This means <code>meta.id</code> alone (without explicit <code>!= null</code>) checks if the ID exists and isn't empty. Let's use this to filter out samples that don't meet our quality requirements.</p>
<p>Add the following before the branch operation:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><input id="__tabbed_20_2" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">After</label><label for="__tabbed_20_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-28">28</a></span>
<span class="normal"><a href="#__codelineno-85-29">29</a></span>
<span class="normal"><a href="#__codelineno-85-30">30</a></span>
<span class="normal"><a href="#__codelineno-85-31">31</a></span>
<span class="normal"><a href="#__codelineno-85-32">32</a></span>
<span class="normal"><a href="#__codelineno-85-33">33</a></span>
<span class="normal"><a href="#__codelineno-85-34">34</a></span>
<span class="normal"><a href="#__codelineno-85-35">35</a></span>
<span class="normal"><a href="#__codelineno-85-36">36</a></span>
<span class="normal"><a href="#__codelineno-85-37">37</a></span>
<span class="normal"><a href="#__codelineno-85-38">38</a></span>
<span class="normal"><a href="#__codelineno-85-39">39</a></span>
<span class="normal"><a href="#__codelineno-85-40">40</a></span>
<span class="normal"><a href="#__codelineno-85-41">41</a></span>
<span class="normal"><a href="#__codelineno-85-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-85-28" name="__codelineno-85-28"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-85-29" name="__codelineno-85-29"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-85-30" name="__codelineno-85-30"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">separateMetadata</span><span class="o">)</span>
<a id="__codelineno-85-31" name="__codelineno-85-31"></a>
<a id="__codelineno-85-32" name="__codelineno-85-32"></a><span class="hll"><span class="w">    </span><span class="c1">// Filter out invalid or low-quality samples</span>
</span><a id="__codelineno-85-33" name="__codelineno-85-33"></a><span class="hll"><span class="w">    </span><span class="n">ch_valid_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_samples</span>
</span><a id="__codelineno-85-34" name="__codelineno-85-34"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">filter</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">,</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="o">-&gt;</span>
</span><a id="__codelineno-85-35" name="__codelineno-85-35"></a><span class="hll"><span class="w">            </span><span class="n">meta</span><span class="o">.</span><span class="na">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">25000000</span>
</span><a id="__codelineno-85-36" name="__codelineno-85-36"></a><span class="hll"><span class="w">        </span><span class="o">}</span>
</span><a id="__codelineno-85-37" name="__codelineno-85-37"></a><span class="hll">
</span><a id="__codelineno-85-38" name="__codelineno-85-38"></a><span class="hll"><span class="w">    </span><span class="n">trim_branches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_valid_samples</span>
</span><a id="__codelineno-85-39" name="__codelineno-85-39"></a><span class="w">        </span><span class="o">.</span><span class="na">branch</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">,</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-85-40" name="__codelineno-85-40"></a><span class="w">            </span><span class="nl">fastp:</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;human&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">30000000</span>
<a id="__codelineno-85-41" name="__codelineno-85-41"></a><span class="w">            </span><span class="nl">trimgalore:</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-85-42" name="__codelineno-85-42"></a><span class="w">        </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-28">28</a></span>
<span class="normal"><a href="#__codelineno-86-29">29</a></span>
<span class="normal"><a href="#__codelineno-86-30">30</a></span>
<span class="normal"><a href="#__codelineno-86-31">31</a></span>
<span class="normal"><a href="#__codelineno-86-32">32</a></span>
<span class="normal"><a href="#__codelineno-86-33">33</a></span>
<span class="normal"><a href="#__codelineno-86-34">34</a></span>
<span class="normal"><a href="#__codelineno-86-35">35</a></span>
<span class="normal"><a href="#__codelineno-86-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-86-28" name="__codelineno-86-28"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-86-29" name="__codelineno-86-29"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-86-30" name="__codelineno-86-30"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">separateMetadata</span><span class="o">)</span>
<a id="__codelineno-86-31" name="__codelineno-86-31"></a>
<a id="__codelineno-86-32" name="__codelineno-86-32"></a><span class="hll"><span class="w">    </span><span class="n">trim_branches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_samples</span>
</span><a id="__codelineno-86-33" name="__codelineno-86-33"></a><span class="w">        </span><span class="o">.</span><span class="na">branch</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">,</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-86-34" name="__codelineno-86-34"></a><span class="w">            </span><span class="nl">fastp:</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;human&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">30000000</span>
<a id="__codelineno-86-35" name="__codelineno-86-35"></a><span class="w">            </span><span class="nl">trimgalore:</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-86-36" name="__codelineno-86-36"></a><span class="w">        </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Run the workflow again:</p>
<div class="highlight"><span class="filename">Test filtering samples</span><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>Because we've chosen a filter that excludes some samples, you should see fewer tasks executed:</p>
<div class="highlight"><span class="filename">Filtered samples results</span><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="go">N E X T F L O W  ~  version 25.04.3</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="go">Launching `main.nf` [lonely_williams] DSL2 - revision: d0b3f121ec</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="go">[94/b48eac] Submitted process &gt; FASTP (2)</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="go">[2c/d2b28f] Submitted process &gt; GENERATE_REPORT (2)</span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="go">[65/2e3be4] Submitted process &gt; GENERATE_REPORT (1)</span>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="go">[94/b48eac] NOTE: Process `FASTP (2)` terminated with an error exit status (137) -- Execution is retried (1)</span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="go">[3e/0d8664] Submitted process &gt; TRIMGALORE (1)</span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="go">[6a/9137b0] Submitted process &gt; FASTP (1)</span>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="go">[6a/9137b0] NOTE: Process `FASTP (1)` terminated with an error exit status (137) -- Execution is retried (1)</span>
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="go">[83/577ac0] Submitted process &gt; GENERATE_REPORT (3)</span>
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="go">[a2/5117de] Re-submitted process &gt; FASTP (1)</span>
<a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="go">[1f/a1a4ca] Re-submitted process &gt; FASTP (2)</span>
</code></pre></div>
<p>The filter expression <code>meta.id &amp;&amp; meta.organism &amp;&amp; meta.depth &gt;= 25000000</code> combines truthiness with explicit comparisons:</p>
<ul>
<li><code>meta.id &amp;&amp; meta.organism</code> checks that both fields exist and are non-empty (using truthiness)</li>
<li><code>meta.depth &gt;= 25000000</code> ensures sufficient sequencing depth with an explicit comparison</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Truthiness in Practice</p>
<p>The expression <code>meta.id &amp;&amp; meta.organism</code> is more concise than writing:
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="n">meta</span><span class="o">.</span><span class="na">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
</code></pre></div></p>
<p>This makes filtering logic much cleaner and easier to read.</p>
</div>
<h3 id="takeaway_4">Takeaway<a class="headerlink" href="#takeaway_4" title="Permanent link">&para;</a></h3>
<p>In this section, you've learned to use conditional logic to control workflow execution using the closure interfaces of Nextflow operators like <code>.branch{}</code> and <code>.filter{}</code>, leveraging truthiness to write concise conditional expressions.</p>
<p>Our pipeline now intelligently routes samples through appropriate processes, but production workflows need to handle invalid data gracefully. Let's make our workflow robust against missing or null values.</p>
<hr />
<h2 id="6-safe-navigation-and-elvis-operators">6. Safe Navigation and Elvis Operators<a class="headerlink" href="#6-safe-navigation-and-elvis-operators" title="Permanent link">&para;</a></h2>
<p>Our <code>separateMetadata</code> function currently assumes all CSV fields are present and valid. But what happens with incomplete data? Let's find out.</p>
<h3 id="61-the-problem-accessing-properties-that-dont-exist">6.1. The Problem: Accessing Properties That Don't Exist<a class="headerlink" href="#61-the-problem-accessing-properties-that-dont-exist" title="Permanent link">&para;</a></h3>
<p>Let's say we want to add support for optional sequencing run information. In some labs, samples might have an additional field for the sequencing run ID or batch number, but our current CSV doesn't have this column. Let's try to access it anyway.</p>
<p>Modify the <code>separateMetadata</code> function to include a run_id field:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:2"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><input id="__tabbed_21_2" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">After</label><label for="__tabbed_21_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-90-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-90-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-90-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-90-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-90-10">10</a></span>
<span class="normal"><a href="#__codelineno-90-11">11</a></span>
<span class="normal"><a href="#__codelineno-90-12">12</a></span>
<span class="normal"><a href="#__codelineno-90-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-90-5" name="__codelineno-90-5"></a><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-90-7" name="__codelineno-90-7"></a><span class="w">        </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-90-8" name="__codelineno-90-8"></a><span class="w">        </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-90-9" name="__codelineno-90-9"></a><span class="w">        </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-90-10" name="__codelineno-90-10"></a><span class="w">        </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-90-11" name="__codelineno-90-11"></a><span class="w">        </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-90-12" name="__codelineno-90-12"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-90-13" name="__codelineno-90-13"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">run_id</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-91-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-91-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-91-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-91-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-91-10">10</a></span>
<span class="normal"><a href="#__codelineno-91-11">11</a></span>
<span class="normal"><a href="#__codelineno-91-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-91-5" name="__codelineno-91-5"></a><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-91-6" name="__codelineno-91-6"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-91-7" name="__codelineno-91-7"></a><span class="w">        </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-91-8" name="__codelineno-91-8"></a><span class="w">        </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-91-9" name="__codelineno-91-9"></a><span class="w">        </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-91-10" name="__codelineno-91-10"></a><span class="w">        </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-91-11" name="__codelineno-91-11"></a><span class="w">        </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-91-12" name="__codelineno-91-12"></a><span class="w">    </span><span class="o">]</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Now run the workflow:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>It crashes with a NullPointerException:</p>
<div class="highlight"><span class="filename">Null pointer error</span><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="go">Launching `main.nf` [trusting_torvalds] DSL2 - revision: b56fbfbce2</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="go">ERROR ~ Cannot invoke method toUpperCase() on null object</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>
<a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="go"> -- Check script &#39;main.nf&#39; at line: 13 or see &#39;.nextflow.log&#39; file for more details</span>
</code></pre></div>
<p>The problem is that <code>row.run_id</code> returns <code>null</code> because the <code>run_id</code> column doesn't exist in our CSV. When we try to call <code>.toUpperCase()</code> on <code>null</code>, it crashes. This is where the safe navigation operator saves the day.</p>
<h3 id="62-safe-navigation-operator">6.2. Safe Navigation Operator (<code>?.</code>)<a class="headerlink" href="#62-safe-navigation-operator" title="Permanent link">&para;</a></h3>
<p>The safe navigation operator (<code>?.</code>) returns <code>null</code> instead of throwing an exception when called on a <code>null</code> value. If the object before <code>?.</code> is <code>null</code>, the entire expression evaluates to <code>null</code> without executing the method.</p>
<p>Update the function to use safe navigation:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:2"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><input id="__tabbed_22_2" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">After</label><label for="__tabbed_22_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-94-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-94-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-94-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-94-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-94-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-94-10">10</a></span>
<span class="normal"><a href="#__codelineno-94-11">11</a></span>
<span class="normal"><a href="#__codelineno-94-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-94-4" name="__codelineno-94-4"></a><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-94-5" name="__codelineno-94-5"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-94-6" name="__codelineno-94-6"></a><span class="w">        </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-94-7" name="__codelineno-94-7"></a><span class="w">        </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-94-8" name="__codelineno-94-8"></a><span class="w">        </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-94-9" name="__codelineno-94-9"></a><span class="w">        </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-94-10" name="__codelineno-94-10"></a><span class="w">        </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-94-11" name="__codelineno-94-11"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-94-12" name="__codelineno-94-12"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">run_id</span><span class="o">?.</span><span class="na">toUpperCase</span><span class="o">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-95-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-95-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-95-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-95-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-95-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-95-10">10</a></span>
<span class="normal"><a href="#__codelineno-95-11">11</a></span>
<span class="normal"><a href="#__codelineno-95-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-95-6" name="__codelineno-95-6"></a><span class="w">        </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-95-7" name="__codelineno-95-7"></a><span class="w">        </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-95-8" name="__codelineno-95-8"></a><span class="w">        </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-95-9" name="__codelineno-95-9"></a><span class="w">        </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-95-10" name="__codelineno-95-10"></a><span class="w">        </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-95-11" name="__codelineno-95-11"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-95-12" name="__codelineno-95-12"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">run_id</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Run again:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>No crash! The workflow now handles the missing field gracefully. When <code>row.run_id</code> is <code>null</code>, the <code>?.</code> operator prevents the <code>.toUpperCase()</code> call, and <code>run_id</code> becomes <code>null</code> instead of causing an exception.</p>
<h3 id="63-elvis-operator-for-defaults">6.3. Elvis Operator (<code>?:</code>) for Defaults<a class="headerlink" href="#63-elvis-operator-for-defaults" title="Permanent link">&para;</a></h3>
<p>The Elvis operator (<code>?:</code>) provides default values when the left side is "falsy" (as explained previously). It's named after Elvis Presley because <code>?:</code> looks like his famous hair and eyes when viewed sideways!</p>
<p>Now that we're using safe navigation, <code>run_id</code> will be <code>null</code> for samples without that field. Let's use the Elvis operator to provide a default value and add it to our <code>sample_meta</code> map:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:2"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><input id="__tabbed_23_2" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">After</label><label for="__tabbed_23_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-97-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-97-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-97-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-97-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-97-10">10</a></span>
<span class="normal"><a href="#__codelineno-97-11">11</a></span>
<span class="normal"><a href="#__codelineno-97-12">12</a></span>
<span class="normal"><a href="#__codelineno-97-13">13</a></span>
<span class="normal"><a href="#__codelineno-97-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-97-5" name="__codelineno-97-5"></a><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-97-6" name="__codelineno-97-6"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-97-7" name="__codelineno-97-7"></a><span class="w">        </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-97-8" name="__codelineno-97-8"></a><span class="w">        </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-97-9" name="__codelineno-97-9"></a><span class="w">        </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-97-10" name="__codelineno-97-10"></a><span class="w">        </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-97-11" name="__codelineno-97-11"></a><span class="w">        </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-97-12" name="__codelineno-97-12"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-97-13" name="__codelineno-97-13"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">run_id</span><span class="o">?.</span><span class="na">toUpperCase</span><span class="o">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s1">&#39;UNSPECIFIED&#39;</span>
</span><a id="__codelineno-97-14" name="__codelineno-97-14"></a><span class="hll"><span class="w">    </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">run_id</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-98-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-98-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-98-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-98-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-98-10">10</a></span>
<span class="normal"><a href="#__codelineno-98-11">11</a></span>
<span class="normal"><a href="#__codelineno-98-12">12</a></span>
<span class="normal"><a href="#__codelineno-98-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-98-5" name="__codelineno-98-5"></a><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<a id="__codelineno-98-7" name="__codelineno-98-7"></a><span class="w">        </span><span class="nl">id:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sample_id</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-98-8" name="__codelineno-98-8"></a><span class="w">        </span><span class="nl">organism:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">organism</span><span class="o">,</span>
<a id="__codelineno-98-9" name="__codelineno-98-9"></a><span class="w">        </span><span class="nl">tissue:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">tissue_type</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">(),</span>
<a id="__codelineno-98-10" name="__codelineno-98-10"></a><span class="w">        </span><span class="nl">depth:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">sequencing_depth</span><span class="o">.</span><span class="na">toInteger</span><span class="o">(),</span>
<a id="__codelineno-98-11" name="__codelineno-98-11"></a><span class="w">        </span><span class="nl">quality:</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">quality_score</span><span class="o">.</span><span class="na">toDouble</span><span class="o">()</span>
<a id="__codelineno-98-12" name="__codelineno-98-12"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-98-13" name="__codelineno-98-13"></a><span class="hll"><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="na">run_id</span><span class="o">?.</span><span class="na">toUpperCase</span><span class="o">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Also add a <code>view()</code> operator in the workflow to see the results:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:2"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><input id="__tabbed_24_2" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">After</label><label for="__tabbed_24_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-30">30</a></span>
<span class="normal"><a href="#__codelineno-99-31">31</a></span>
<span class="normal"><a href="#__codelineno-99-32">32</a></span>
<span class="normal"><a href="#__codelineno-99-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-99-30" name="__codelineno-99-30"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-99-31" name="__codelineno-99-31"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-99-32" name="__codelineno-99-32"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-99-33" name="__codelineno-99-33"></a><span class="hll"><span class="w">        </span><span class="o">.</span><span class="na">view</span><span class="o">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-30">30</a></span>
<span class="normal"><a href="#__codelineno-100-31">31</a></span>
<span class="normal"><a href="#__codelineno-100-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-100-30" name="__codelineno-100-30"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-100-31" name="__codelineno-100-31"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-100-32" name="__codelineno-100-32"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>and run the workflow:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>You'll see output like this:</p>
<div class="highlight"><span class="filename">View output with run field</span><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="go">[[id:sample_001, organism:human, tissue:liver, depth:30000000, quality:38.5, run:UNSPECIFIED, sample_num:1, lane:001, read:R1, chunk:001, priority:normal], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_001_S1_L001_R1_001.fastq]</span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="go">[[id:sample_002, organism:mouse, tissue:brain, depth:25000000, quality:35.2, run:UNSPECIFIED, sample_num:2, lane:001, read:R1, chunk:001, priority:normal], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_002_S2_L001_R1_001.fastq]</span>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="go">[[id:sample_003, organism:human, tissue:kidney, depth:45000000, quality:42.1, run:UNSPECIFIED, sample_num:3, lane:001, read:R1, chunk:001, priority:high], /workspaces/training/side-quests/essential_scripting_patterns/data/sequences/SAMPLE_003_S3_L001_R1_001.fastq]</span>
</code></pre></div>
<p>Perfect! Now all samples have a <code>run</code> field with either their actual run ID (in uppercase) or the default value 'UNSPECIFIED'. The combination of <code>?.</code> and <code>?:</code> provides both safety (no crashes) and sensible defaults.</p>
<p>Take out the <code>.view()</code> operator now that we've confirmed it works.</p>
<div class="admonition tip">
<p class="admonition-title">Combining Safe Navigation and Elvis</p>
<p>The pattern <code>value?.method() ?: 'default'</code> is common in production workflows:</p>
<ul>
<li><code>value?.method()</code> - Safely calls method, returns <code>null</code> if <code>value</code> is <code>null</code></li>
<li><code>?: 'default'</code> - Provides fallback if result is <code>null</code></li>
</ul>
<p>This pattern handles missing/incomplete data gracefully.</p>
</div>
<p>Use these operators consistently in functions, operator closures (<code>.map{}</code>, <code>.filter{}</code>), process scripts, and config files. They prevent crashes when handling real-world data.</p>
<h3 id="takeaway_5">Takeaway<a class="headerlink" href="#takeaway_5" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Safe navigation (<code>?.</code>)</strong>: Prevents crashes on null values - returns null instead of throwing exception</li>
<li><strong>Elvis operator (<code>?:</code>)</strong>: Provides defaults - <code>value ?: 'default'</code></li>
<li><strong>Combining</strong>: <code>value?.method() ?: 'default'</code> is the common pattern</li>
</ul>
<p>These operators make workflows resilient to incomplete data - essential for real-world work.</p>
<hr />
<h2 id="7-validation-with-error-and-logwarn">7. Validation with <code>error()</code> and <code>log.warn</code><a class="headerlink" href="#7-validation-with-error-and-logwarn" title="Permanent link">&para;</a></h2>
<p>Sometimes you need to stop the workflow immediately if input parameters are invalid. In Nextflow, you can use built-in functions like <code>error()</code> and <code>log.warn</code>, as well as standard programming constructs like <code>if</code> statements and boolean logic, to implement validation logic. Let's add validation to our workflow.</p>
<p>Create a validation function before your workflow block, call it from the workflow, and change the channel creation to use a parameter for the CSV file path. If the parameter is missing or the file doesn't exist, call <code>error()</code> to stop execution with a clear message.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="25:2"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><input id="__tabbed_25_2" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">After</label><label for="__tabbed_25_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-103-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-103-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-103-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-103-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-103-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-103-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-103-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-103-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-103-10">10</a></span>
<span class="normal"><a href="#__codelineno-103-11">11</a></span>
<span class="normal"><a href="#__codelineno-103-12">12</a></span>
<span class="normal"><a href="#__codelineno-103-13">13</a></span>
<span class="normal"><a href="#__codelineno-103-14">14</a></span>
<span class="normal"><a href="#__codelineno-103-15">15</a></span>
<span class="normal"><a href="#__codelineno-103-16">16</a></span>
<span class="normal"><a href="#__codelineno-103-17">17</a></span>
<span class="normal"><a href="#__codelineno-103-18">18</a></span>
<span class="normal"><a href="#__codelineno-103-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/trimgalore.nf&#39;</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">GENERATE_REPORT</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/generate_report.nf&#39;</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a>
<a id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="hll"><span class="kt">def</span><span class="w"> </span><span class="nf">validateInputs</span><span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="hll"><span class="w">    </span><span class="c1">// Check input parameter is provided</span>
</span><a id="__codelineno-103-7" name="__codelineno-103-7"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(!</span><span class="n">params</span><span class="o">.</span><span class="na">input</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-103-8" name="__codelineno-103-8"></a><span class="hll"><span class="w">        </span><span class="n">error</span><span class="o">(</span><span class="s2">&quot;Input CSV file path not provided. Please specify --input &lt;file.csv&gt;&quot;</span><span class="o">)</span>
</span><a id="__codelineno-103-9" name="__codelineno-103-9"></a><span class="hll"><span class="w">    </span><span class="o">}</span>
</span><a id="__codelineno-103-10" name="__codelineno-103-10"></a><span class="hll">
</span><a id="__codelineno-103-11" name="__codelineno-103-11"></a><span class="hll"><span class="w">    </span><span class="c1">// Check CSV file exists</span>
</span><a id="__codelineno-103-12" name="__codelineno-103-12"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(!</span><span class="n">file</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="na">input</span><span class="o">).</span><span class="na">exists</span><span class="o">())</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-103-13" name="__codelineno-103-13"></a><span class="hll"><span class="w">        </span><span class="n">error</span><span class="o">(</span><span class="s2">&quot;Input CSV file not found: ${params.input}&quot;</span><span class="o">)</span>
</span><a id="__codelineno-103-14" name="__codelineno-103-14"></a><span class="hll"><span class="w">    </span><span class="o">}</span>
</span><a id="__codelineno-103-15" name="__codelineno-103-15"></a><span class="hll"><span class="o">}</span>
</span><a id="__codelineno-103-16" name="__codelineno-103-16"></a><span class="hll"><span class="o">...</span>
</span><a id="__codelineno-103-17" name="__codelineno-103-17"></a><span class="hll"><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-103-18" name="__codelineno-103-18"></a><span class="hll"><span class="w">    </span><span class="n">validateInputs</span><span class="o">()</span>
</span><a id="__codelineno-103-19" name="__codelineno-103-19"></a><span class="hll"><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="na">input</span><span class="o">)</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span>
<span class="normal"><a href="#__codelineno-104-2">2</a></span>
<span class="normal"><a href="#__codelineno-104-3">3</a></span>
<span class="normal"><a href="#__codelineno-104-4">4</a></span>
<span class="normal"><a href="#__codelineno-104-5">5</a></span>
<span class="normal"><a href="#__codelineno-104-6">6</a></span>
<span class="normal"><a href="#__codelineno-104-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">FASTP</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/fastp.nf&#39;</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/trimgalore.nf&#39;</span>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a><span class="n">include</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">GENERATE_REPORT</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s1">&#39;./modules/generate_report.nf&#39;</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a>
<a id="__codelineno-104-5" name="__codelineno-104-5"></a><span class="o">...</span>
<a id="__codelineno-104-6" name="__codelineno-104-6"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-104-7" name="__codelineno-104-7"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Now try running without the CSV file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf
</code></pre></div>
<p>The workflow stops immediately with a clear error message instead of failing mysteriously later!</p>
<div class="highlight"><span class="filename">Validation error output</span><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="go">Launching `main.nf` [confident_coulomb] DSL2 - revision: 07059399ed</span>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="go">WARN: Access to undefined parameter `input` -- Initialise it to a default value eg. `params.input = some_value`</span>
<a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="go">Input CSV file path not provided. Please specify --input &lt;file.csv&gt;</span>
</code></pre></div>
<p>Now run it with a non-existent file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>--input<span class="w"> </span>./data/nonexistent.csv
</code></pre></div>
<p>Observe the error:</p>
<div class="highlight"><span class="filename">File not found error output</span><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="go">Launching `main.nf` [cranky_gates] DSL2 - revision: 26839ae3eb</span>
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a>
<a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="go">Input CSV file not found: ./data/nonexistent.csv</span>
</code></pre></div>
<p>Finally, run it with the correct file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>--input<span class="w"> </span>./data/samples.csv
</code></pre></div>
<p>This time it runs successfully.</p>
<p>You can also add validation within the <code>separateMetadata</code> function. Let's use the non-fatal <code>log.warn</code> to issue warnings for samples with low sequencing depth, but still allow the workflow to continue:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="26:2"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><input id="__tabbed_26_2" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">After</label><label for="__tabbed_26_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1">1</a></span>
<span class="normal"><a href="#__codelineno-110-2">2</a></span>
<span class="normal"><a href="#__codelineno-110-3">3</a></span>
<span class="normal"><a href="#__codelineno-110-4">4</a></span>
<span class="normal"><a href="#__codelineno-110-5">5</a></span>
<span class="normal"><a href="#__codelineno-110-6">6</a></span>
<span class="normal"><a href="#__codelineno-110-7">7</a></span>
<span class="normal"><a href="#__codelineno-110-8">8</a></span>
<span class="normal"><a href="#__codelineno-110-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a><span class="hll"><span class="w">    </span><span class="c1">// Validate data makes sense</span>
</span><a id="__codelineno-110-4" name="__codelineno-110-4"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">sample_meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">30000000</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-110-5" name="__codelineno-110-5"></a><span class="hll"><span class="w">        </span><span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="w"> </span><span class="s2">&quot;Low sequencing depth for ${sample_meta.id}: ${sample_meta.depth}&quot;</span>
</span><a id="__codelineno-110-6" name="__codelineno-110-6"></a><span class="hll"><span class="w">    </span><span class="o">}</span>
</span><a id="__codelineno-110-7" name="__codelineno-110-7"></a>
<a id="__codelineno-110-8" name="__codelineno-110-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
<a id="__codelineno-110-9" name="__codelineno-110-9"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1">1</a></span>
<span class="normal"><a href="#__codelineno-111-2">2</a></span>
<span class="normal"><a href="#__codelineno-111-3">3</a></span>
<span class="normal"><a href="#__codelineno-111-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Run the workflow again with the original CSV:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>--input<span class="w"> </span>./data/samples.csv
</code></pre></div>
<p>... and you'll see a warning about low sequencing depth for one of the samples:</p>
<div class="highlight"><span class="filename">Warning output</span><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="go"> N E X T F L O W   ~  version 25.04.3</span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="go">Launching `main.nf` [awesome_goldwasser] DSL2 - revision: a31662a7c1</span>
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="go">executor &gt;  local (5)</span>
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="go">[ce/df5eeb] process &gt; FASTP (2)           [100%] 2 of 2 ✔</span>
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="go">[-        ] process &gt; TRIMGALORE          -</span>
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="go">[d1/7d2b4b] process &gt; GENERATE_REPORT (3) [100%] 3 of 3 ✔</span>
<a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="go">WARN: Low sequencing depth for sample_002: 25000000</span>
</code></pre></div>
<h3 id="takeaway_6">Takeaway<a class="headerlink" href="#takeaway_6" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>error()</code></strong>: Stops workflow immediately with clear message</li>
<li><strong><code>log.warn</code></strong>: Issues warnings without stopping workflow</li>
<li><strong>Early validation</strong>: Check inputs before processing to fail fast with helpful errors</li>
<li><strong>Validation functions</strong>: Create reusable validation logic that can be called at workflow start</li>
</ul>
<p>Proper validation makes workflows more robust and user-friendly by catching problems early with clear error messages.</p>
<hr />
<h2 id="8-workflow-event-handlers">8. Workflow Event Handlers<a class="headerlink" href="#8-workflow-event-handlers" title="Permanent link">&para;</a></h2>
<p>Up until now, we've been writing code in our workflow scripts and process definitions. But there's one more important feature you should know about: workflow event handlers.</p>
<p>Event handlers are closures that run at specific points in your workflow's lifecycle. They're perfect for adding logging, notifications, or cleanup operations. These handlers should be defined in your workflow script alongside your workflow definition.</p>
<h3 id="81-the-oncomplete-handler">8.1. The <code>onComplete</code> Handler<a class="headerlink" href="#81-the-oncomplete-handler" title="Permanent link">&para;</a></h3>
<p>The most commonly used event handler is <code>onComplete</code>, which runs when your workflow finishes (whether it succeeded or failed). Let's add one to summarize our pipeline results.</p>
<p>Add the event handler to your <code>main.nf</code> file, inside your workflow definition:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="27:2"><input checked="checked" id="__tabbed_27_1" name="__tabbed_27" type="radio" /><input id="__tabbed_27_2" name="__tabbed_27" type="radio" /><div class="tabbed-labels"><label for="__tabbed_27_1">After</label><label for="__tabbed_27_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-66">66</a></span>
<span class="normal"><a href="#__codelineno-114-67">67</a></span>
<span class="normal"><a href="#__codelineno-114-68">68</a></span>
<span class="normal"><a href="#__codelineno-114-69">69</a></span>
<span class="normal"><a href="#__codelineno-114-70">70</a></span>
<span class="normal"><a href="#__codelineno-114-71">71</a></span>
<span class="normal"><a href="#__codelineno-114-72">72</a></span>
<span class="normal"><a href="#__codelineno-114-73">73</a></span>
<span class="normal"><a href="#__codelineno-114-74">74</a></span>
<span class="normal"><a href="#__codelineno-114-75">75</a></span>
<span class="normal"><a href="#__codelineno-114-76">76</a></span>
<span class="normal"><a href="#__codelineno-114-77">77</a></span>
<span class="normal"><a href="#__codelineno-114-78">78</a></span>
<span class="normal"><a href="#__codelineno-114-79">79</a></span>
<span class="normal"><a href="#__codelineno-114-80">80</a></span>
<span class="normal"><a href="#__codelineno-114-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-114-66" name="__codelineno-114-66"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">fastp</span><span class="o">)</span>
<a id="__codelineno-114-67" name="__codelineno-114-67"></a><span class="w">    </span><span class="n">ch_trimgalore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">trimgalore</span><span class="o">)</span>
<a id="__codelineno-114-68" name="__codelineno-114-68"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-114-69" name="__codelineno-114-69"></a>
<a id="__codelineno-114-70" name="__codelineno-114-70"></a><span class="hll"><span class="w">    </span><span class="n">workflow</span><span class="o">.</span><span class="na">onComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-114-71" name="__codelineno-114-71"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><a id="__codelineno-114-72" name="__codelineno-114-72"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Pipeline execution summary:&quot;</span>
</span><a id="__codelineno-114-73" name="__codelineno-114-73"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;==========================&quot;</span>
</span><a id="__codelineno-114-74" name="__codelineno-114-74"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Completed at: ${workflow.complete}&quot;</span>
</span><a id="__codelineno-114-75" name="__codelineno-114-75"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Duration    : ${workflow.duration}&quot;</span>
</span><a id="__codelineno-114-76" name="__codelineno-114-76"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Success     : ${workflow.success}&quot;</span>
</span><a id="__codelineno-114-77" name="__codelineno-114-77"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;workDir     : ${workflow.workDir}&quot;</span>
</span><a id="__codelineno-114-78" name="__codelineno-114-78"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;exit status : ${workflow.exitStatus}&quot;</span>
</span><a id="__codelineno-114-79" name="__codelineno-114-79"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><a id="__codelineno-114-80" name="__codelineno-114-80"></a><span class="hll"><span class="w">    </span><span class="o">}</span>
</span><a id="__codelineno-114-81" name="__codelineno-114-81"></a><span class="hll"><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-66">66</a></span>
<span class="normal"><a href="#__codelineno-115-67">67</a></span>
<span class="normal"><a href="#__codelineno-115-68">68</a></span>
<span class="normal"><a href="#__codelineno-115-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-115-66" name="__codelineno-115-66"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">fastp</span><span class="o">)</span>
<a id="__codelineno-115-67" name="__codelineno-115-67"></a><span class="w">    </span><span class="n">ch_trimgalore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">trimgalore</span><span class="o">)</span>
<a id="__codelineno-115-68" name="__codelineno-115-68"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-115-69" name="__codelineno-115-69"></a><span class="hll"><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>This closure runs when the workflow completes. Inside, you have access to the <code>workflow</code> object which provides useful properties about the execution.</p>
<p>Run your workflow and you'll see this summary appear at the end!</p>
<div class="highlight"><span class="filename">Run with onComplete handler</span><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>nextflow<span class="w"> </span>run<span class="w"> </span>main.nf<span class="w"> </span>--input<span class="w"> </span>./data/samples.csv<span class="w"> </span>-ansi-log<span class="w"> </span><span class="nb">false</span>
</code></pre></div>
<div class="highlight"><span class="filename">onComplete output</span><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="go">N E X T F L O W  ~  version 25.04.3</span>
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="go">Launching `main.nf` [marvelous_boltzmann] DSL2 - revision: a31662a7c1</span>
<a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="go">WARN: Low sequencing depth for sample_002: 25000000</span>
<a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="go">[9b/d48e40] Submitted process &gt; FASTP (2)</span>
<a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="go">[6a/73867a] Submitted process &gt; GENERATE_REPORT (2)</span>
<a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="go">[79/ad0ac5] Submitted process &gt; GENERATE_REPORT (1)</span>
<a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="go">[f3/bda6cb] Submitted process &gt; FASTP (1)</span>
<a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="go">[34/d5b52f] Submitted process &gt; GENERATE_REPORT (3)</span>
<a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a>
<a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a><span class="go">Pipeline execution summary:</span>
<a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a><span class="go">==========================</span>
<a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a><span class="go">Completed at: 2025-10-10T12:14:24.885384+01:00</span>
<a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a><span class="go">Duration    : 2.9s</span>
<a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a><span class="go">Success     : true</span>
<a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a><span class="go">workDir     : /workspaces/training/side-quests/essential_scripting_patterns/work</span>
<a id="__codelineno-117-16" name="__codelineno-117-16" href="#__codelineno-117-16"></a><span class="go">exit status : 0</span>
</code></pre></div>
<p>Let's make it more useful by adding conditional logic:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="28:2"><input checked="checked" id="__tabbed_28_1" name="__tabbed_28" type="radio" /><input id="__tabbed_28_2" name="__tabbed_28" type="radio" /><div class="tabbed-labels"><label for="__tabbed_28_1">After</label><label for="__tabbed_28_2">Before</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-66">66</a></span>
<span class="normal"><a href="#__codelineno-118-67">67</a></span>
<span class="normal"><a href="#__codelineno-118-68">68</a></span>
<span class="normal"><a href="#__codelineno-118-69">69</a></span>
<span class="normal"><a href="#__codelineno-118-70">70</a></span>
<span class="normal"><a href="#__codelineno-118-71">71</a></span>
<span class="normal"><a href="#__codelineno-118-72">72</a></span>
<span class="normal"><a href="#__codelineno-118-73">73</a></span>
<span class="normal"><a href="#__codelineno-118-74">74</a></span>
<span class="normal"><a href="#__codelineno-118-75">75</a></span>
<span class="normal"><a href="#__codelineno-118-76">76</a></span>
<span class="normal"><a href="#__codelineno-118-77">77</a></span>
<span class="normal"><a href="#__codelineno-118-78">78</a></span>
<span class="normal"><a href="#__codelineno-118-79">79</a></span>
<span class="normal"><a href="#__codelineno-118-80">80</a></span>
<span class="normal"><a href="#__codelineno-118-81">81</a></span>
<span class="normal"><a href="#__codelineno-118-82">82</a></span>
<span class="normal"><a href="#__codelineno-118-83">83</a></span>
<span class="normal"><a href="#__codelineno-118-84">84</a></span>
<span class="normal"><a href="#__codelineno-118-85">85</a></span>
<span class="normal"><a href="#__codelineno-118-86">86</a></span>
<span class="normal"><a href="#__codelineno-118-87">87</a></span>
<span class="normal"><a href="#__codelineno-118-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-118-66" name="__codelineno-118-66"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">fastp</span><span class="o">)</span>
<a id="__codelineno-118-67" name="__codelineno-118-67"></a><span class="w">    </span><span class="n">ch_trimgalore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">trimgalore</span><span class="o">)</span>
<a id="__codelineno-118-68" name="__codelineno-118-68"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-118-69" name="__codelineno-118-69"></a>
<a id="__codelineno-118-70" name="__codelineno-118-70"></a><span class="hll"><span class="w">    </span><span class="n">workflow</span><span class="o">.</span><span class="na">onComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-118-71" name="__codelineno-118-71"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><a id="__codelineno-118-72" name="__codelineno-118-72"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Pipeline execution summary:&quot;</span>
</span><a id="__codelineno-118-73" name="__codelineno-118-73"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;==========================&quot;</span>
</span><a id="__codelineno-118-74" name="__codelineno-118-74"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Completed at: ${workflow.complete}&quot;</span>
</span><a id="__codelineno-118-75" name="__codelineno-118-75"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Duration    : ${workflow.duration}&quot;</span>
</span><a id="__codelineno-118-76" name="__codelineno-118-76"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Success     : ${workflow.success}&quot;</span>
</span><a id="__codelineno-118-77" name="__codelineno-118-77"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;workDir     : ${workflow.workDir}&quot;</span>
</span><a id="__codelineno-118-78" name="__codelineno-118-78"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;exit status : ${workflow.exitStatus}&quot;</span>
</span><a id="__codelineno-118-79" name="__codelineno-118-79"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><a id="__codelineno-118-80" name="__codelineno-118-80"></a><span class="hll">
</span><a id="__codelineno-118-81" name="__codelineno-118-81"></a><span class="hll"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">workflow</span><span class="o">.</span><span class="na">success</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-118-82" name="__codelineno-118-82"></a><span class="hll"><span class="w">            </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;✅ Pipeline completed successfully!&quot;</span>
</span><a id="__codelineno-118-83" name="__codelineno-118-83"></a><span class="hll"><span class="w">        </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-118-84" name="__codelineno-118-84"></a><span class="hll"><span class="w">            </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;❌ Pipeline failed!&quot;</span>
</span><a id="__codelineno-118-85" name="__codelineno-118-85"></a><span class="hll"><span class="w">            </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Error: ${workflow.errorMessage}&quot;</span>
</span><a id="__codelineno-118-86" name="__codelineno-118-86"></a><span class="hll"><span class="w">        </span><span class="o">}</span>
</span><a id="__codelineno-118-87" name="__codelineno-118-87"></a><span class="hll"><span class="w">    </span><span class="o">}</span>
</span><a id="__codelineno-118-88" name="__codelineno-118-88"></a><span class="o">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">main.nf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-66">66</a></span>
<span class="normal"><a href="#__codelineno-119-67">67</a></span>
<span class="normal"><a href="#__codelineno-119-68">68</a></span>
<span class="normal"><a href="#__codelineno-119-69">69</a></span>
<span class="normal"><a href="#__codelineno-119-70">70</a></span>
<span class="normal"><a href="#__codelineno-119-71">71</a></span>
<span class="normal"><a href="#__codelineno-119-72">72</a></span>
<span class="normal"><a href="#__codelineno-119-73">73</a></span>
<span class="normal"><a href="#__codelineno-119-74">74</a></span>
<span class="normal"><a href="#__codelineno-119-75">75</a></span>
<span class="normal"><a href="#__codelineno-119-76">76</a></span>
<span class="normal"><a href="#__codelineno-119-77">77</a></span>
<span class="normal"><a href="#__codelineno-119-78">78</a></span>
<span class="normal"><a href="#__codelineno-119-79">79</a></span>
<span class="normal"><a href="#__codelineno-119-80">80</a></span>
<span class="normal"><a href="#__codelineno-119-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-119-66" name="__codelineno-119-66"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">fastp</span><span class="o">)</span>
<a id="__codelineno-119-67" name="__codelineno-119-67"></a><span class="w">    </span><span class="n">ch_trimgalore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">trimgalore</span><span class="o">)</span>
<a id="__codelineno-119-68" name="__codelineno-119-68"></a><span class="w">    </span><span class="n">GENERATE_REPORT</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-119-69" name="__codelineno-119-69"></a>
<a id="__codelineno-119-70" name="__codelineno-119-70"></a><span class="hll"><span class="w">    </span><span class="n">workflow</span><span class="o">.</span><span class="na">onComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><a id="__codelineno-119-71" name="__codelineno-119-71"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><a id="__codelineno-119-72" name="__codelineno-119-72"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Pipeline execution summary:&quot;</span>
</span><a id="__codelineno-119-73" name="__codelineno-119-73"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;==========================&quot;</span>
</span><a id="__codelineno-119-74" name="__codelineno-119-74"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Completed at: ${workflow.complete}&quot;</span>
</span><a id="__codelineno-119-75" name="__codelineno-119-75"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Duration    : ${workflow.duration}&quot;</span>
</span><a id="__codelineno-119-76" name="__codelineno-119-76"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Success     : ${workflow.success}&quot;</span>
</span><a id="__codelineno-119-77" name="__codelineno-119-77"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;workDir     : ${workflow.workDir}&quot;</span>
</span><a id="__codelineno-119-78" name="__codelineno-119-78"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;exit status : ${workflow.exitStatus}&quot;</span>
</span><a id="__codelineno-119-79" name="__codelineno-119-79"></a><span class="hll"><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><a id="__codelineno-119-80" name="__codelineno-119-80"></a><span class="hll"><span class="w">    </span><span class="o">}</span>
</span><a id="__codelineno-119-81" name="__codelineno-119-81"></a><span class="hll"><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Now we get an even more informative summary, including a success/failure message and the output directory if specified:</p>
<div class="highlight"><span class="filename">Enhanced onComplete output</span><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="go">N E X T F L O W  ~  version 25.04.3</span>
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="go">Launching `main.nf` [boring_linnaeus] DSL2 - revision: a31662a7c1</span>
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="go">WARN: Low sequencing depth for sample_002: 25000000</span>
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="go">[e5/242efc] Submitted process &gt; FASTP (2)</span>
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="go">[3b/74047c] Submitted process &gt; GENERATE_REPORT (3)</span>
<a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a><span class="go">[8a/7a57e6] Submitted process &gt; GENERATE_REPORT (1)</span>
<a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a><span class="go">[a8/b1a31f] Submitted process &gt; GENERATE_REPORT (2)</span>
<a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a><span class="go">[40/648429] Submitted process &gt; FASTP (1)</span>
<a id="__codelineno-120-9" name="__codelineno-120-9" href="#__codelineno-120-9"></a>
<a id="__codelineno-120-10" name="__codelineno-120-10" href="#__codelineno-120-10"></a><span class="go">Pipeline execution summary:</span>
<a id="__codelineno-120-11" name="__codelineno-120-11" href="#__codelineno-120-11"></a><span class="go">==========================</span>
<a id="__codelineno-120-12" name="__codelineno-120-12" href="#__codelineno-120-12"></a><span class="go">Completed at: 2025-10-10T12:16:00.522569+01:00</span>
<a id="__codelineno-120-13" name="__codelineno-120-13" href="#__codelineno-120-13"></a><span class="go">Duration    : 3.6s</span>
<a id="__codelineno-120-14" name="__codelineno-120-14" href="#__codelineno-120-14"></a><span class="go">Success     : true</span>
<a id="__codelineno-120-15" name="__codelineno-120-15" href="#__codelineno-120-15"></a><span class="go">workDir     : /workspaces/training/side-quests/essential_scripting_patterns/work</span>
<a id="__codelineno-120-16" name="__codelineno-120-16" href="#__codelineno-120-16"></a><span class="go">exit status : 0</span>
<a id="__codelineno-120-17" name="__codelineno-120-17" href="#__codelineno-120-17"></a>
<a id="__codelineno-120-18" name="__codelineno-120-18" href="#__codelineno-120-18"></a><span class="go">✅ Pipeline completed successfully!</span>
</code></pre></div>
<p>You can also write the summary to a file using file operations:</p>
<div class="highlight"><span class="filename">main.nf - Writing summary to file</span><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="w">    </span><span class="c1">// ... your workflow code ...</span>
<a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a>
<a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="w">    </span><span class="n">workflow</span><span class="o">.</span><span class="na">onComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="w">        </span><span class="kt">def</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="s2">        Pipeline Execution Summary</span>
<a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="s2">        ===========================</span>
<a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="s2">        Completed: ${workflow.complete}</span>
<a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="s2">        Duration : ${workflow.duration}</span>
<a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a><span class="s2">        Success  : ${workflow.success}</span>
<a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="s2">        Command  : ${workflow.commandLine}</span>
<a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a>
<a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="n">summary</span>
<a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a>
<a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a><span class="w">        </span><span class="c1">// Write to a log file</span>
<a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a><span class="w">        </span><span class="kt">def</span><span class="w"> </span><span class="n">log_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="s2">&quot;${workflow.launchDir}/pipeline_summary.txt&quot;</span><span class="o">)</span>
<a id="__codelineno-121-18" name="__codelineno-121-18" href="#__codelineno-121-18"></a><span class="w">        </span><span class="n">log_file</span><span class="o">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span>
<a id="__codelineno-121-19" name="__codelineno-121-19" href="#__codelineno-121-19"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-121-20" name="__codelineno-121-20" href="#__codelineno-121-20"></a><span class="o">}</span>
</code></pre></div>
<h3 id="82-the-onerror-handler">8.2. The <code>onError</code> Handler<a class="headerlink" href="#82-the-onerror-handler" title="Permanent link">&para;</a></h3>
<p>Besides <code>onComplete</code>, there is one other event handler you can use: <code>onError</code>, which runs only if the workflow fails:</p>
<div class="highlight"><span class="filename">main.nf - onError handler</span><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="w">    </span><span class="c1">// ... your workflow code ...</span>
<a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a>
<a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">    </span><span class="n">workflow</span><span class="o">.</span><span class="na">onError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="w"> </span><span class="mi">50</span>
<a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Pipeline execution failed!&quot;</span>
<a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Error message: ${workflow.errorMessage}&quot;</span>
<a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="w"> </span><span class="mi">50</span>
<a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a>
<a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">        </span><span class="c1">// Write detailed error log</span>
<a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="w">        </span><span class="kt">def</span><span class="w"> </span><span class="n">error_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="s2">&quot;${workflow.launchDir}/error.log&quot;</span><span class="o">)</span>
<a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="w">        </span><span class="n">error_file</span><span class="o">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="s2">        Workflow Error Report</span>
<a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="s2">        =====================</span>
<a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="s2">        Time: ${new Date()}</span>
<a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="s2">        Error: ${workflow.errorMessage}</span>
<a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="s2">        Error report: ${workflow.errorReport ?: &#39;No detailed report available&#39;}</span>
<a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a>
<a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Error details written to: ${error_file}&quot;</span>
<a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="o">}</span>
</code></pre></div>
<p>You can use multiple handlers together in your workflow script:</p>
<div class="highlight"><span class="filename">main.nf - Combined handlers</span><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="w">    </span><span class="c1">// ... your workflow code ...</span>
<a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a>
<a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="w">    </span><span class="n">workflow</span><span class="o">.</span><span class="na">onError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Workflow failed: ${workflow.errorMessage}&quot;</span>
<a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a>
<a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a><span class="w">    </span><span class="n">workflow</span><span class="o">.</span><span class="na">onComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-123-9" name="__codelineno-123-9" href="#__codelineno-123-9"></a><span class="w">        </span><span class="kt">def</span><span class="w"> </span><span class="n">duration_mins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workflow</span><span class="o">.</span><span class="na">duration</span><span class="o">.</span><span class="na">toMinutes</span><span class="o">().</span><span class="na">round</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<a id="__codelineno-123-10" name="__codelineno-123-10" href="#__codelineno-123-10"></a><span class="w">        </span><span class="kt">def</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workflow</span><span class="o">.</span><span class="na">success</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;SUCCESS ✅&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;FAILED ❌&quot;</span>
<a id="__codelineno-123-11" name="__codelineno-123-11" href="#__codelineno-123-11"></a>
<a id="__codelineno-123-12" name="__codelineno-123-12" href="#__codelineno-123-12"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-123-13" name="__codelineno-123-13" href="#__codelineno-123-13"></a><span class="s2">        Pipeline finished: ${status}</span>
<a id="__codelineno-123-14" name="__codelineno-123-14" href="#__codelineno-123-14"></a><span class="s2">        Duration: ${duration_mins} minutes</span>
<a id="__codelineno-123-15" name="__codelineno-123-15" href="#__codelineno-123-15"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-123-16" name="__codelineno-123-16" href="#__codelineno-123-16"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-123-17" name="__codelineno-123-17" href="#__codelineno-123-17"></a><span class="o">}</span>
</code></pre></div>
<h3 id="takeaway_7">Takeaway<a class="headerlink" href="#takeaway_7" title="Permanent link">&para;</a></h3>
<p>In this section, you've learned:</p>
<ul>
<li><strong>Event handler closures</strong>: Closures in your workflow script that run at different lifecycle points</li>
<li><strong><code>onComplete</code> handler</strong>: For execution summaries and result reporting</li>
<li><strong><code>onError</code> handler</strong>: For error handling and logging failures</li>
<li><strong>Workflow object properties</strong>: Accessing <code>workflow.success</code>, <code>workflow.duration</code>, <code>workflow.errorMessage</code>, etc.</li>
</ul>
<p>Event handlers show how you can use the full power of the Nextflow language within your workflow scripts to add sophisticated logging and notification capabilities.</p>
<hr />
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Congratulations, you made it!</p>
<p>Throughout this side quest, you've built a comprehensive sample processing pipeline that evolved from basic metadata handling to a sophisticated, production-ready workflow.
Each section built upon the previous one, demonstrating how programming constructs transform simple workflows into powerful data processing systems, with the following benefits:</p>
<ul>
<li><strong>Clearer code</strong>: Understanding dataflow vs scripting helps you write more organized workflows</li>
<li><strong>Robust handling</strong>: Safe navigation and Elvis operators make workflows resilient to missing data</li>
<li><strong>Flexible processing</strong>: Conditional logic lets your workflows process different sample types appropriately</li>
<li><strong>Adaptive resources</strong>: Dynamic directives optimize resource usage based on input characteristics</li>
</ul>
<p>This progression mirrors the real-world evolution of bioinformatics pipelines, from research prototypes handling a few samples to production systems processing thousands of samples across laboratories and institutions.
Every challenge you solved and pattern you learned reflects actual problems developers face when scaling Nextflow workflows.</p>
<p>Applying these patterns in your own work will enable you to build robust, production-ready workflows.</p>
<h3 id="key-patterns">Key patterns<a class="headerlink" href="#key-patterns" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Dataflow vs Scripting:</strong> You learned to distinguish between dataflow operations (channel orchestration) and scripting (code that manipulates data), including the crucial differences between operations on different types like <code>collect</code> on Channel vs List.</p>
<ul>
<li>Dataflow: channel orchestration</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s1">&#39;*.fastq&#39;</span><span class="o">).</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
</code></pre></div>
<ul>
<li>Scripting: data processing on collections</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="n">sample_data</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">it</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">()</span><span class="w"> </span><span class="o">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Advanced String Processing</strong>: You mastered regular expressions for parsing file names, dynamic script generation in processes, and variable interpolation (Nextflow vs Bash vs Shell).</p>
<ul>
<li>Pattern matching</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="n">filename</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="o">~</span><span class="s">/^(\w+)_(\w+)_(\d+)\.fastq$/</span>
</code></pre></div>
<ul>
<li>Function with conditional return</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="kt">def</span><span class="w"> </span><span class="nf">parseSample</span><span class="o">(</span><span class="n">filename</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">matcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="n">pattern</span>
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">matcher</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span><span class="nl">valid:</span><span class="w"> </span><span class="kc">true</span><span class="o">,</span><span class="w"> </span><span class="nl">data:</span><span class="w"> </span><span class="n">matcher</span><span class="o">[</span><span class="mi">0</span><span class="o">]]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="nl">valid:</span><span class="w"> </span><span class="kc">false</span><span class="o">]</span>
<a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="o">}</span>
</code></pre></div>
<ul>
<li>File collection to command arguments (in process script block)</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="nl">script:</span>
<a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="kt">def</span><span class="w"> </span><span class="n">file_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_files</span><span class="o">.</span><span class="na">collect</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">&quot;--input ${file}&quot;</span><span class="w"> </span><span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39; &#39;</span><span class="o">)</span>
<a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="s2">analysis_tool ${file_args} --output results.txt</span>
<a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>
</li>
<li>
<p><strong>Creating Reusable Functions</strong>: You learned to extract complex logic into named functions that can be called from channel operators, making workflows more readable and maintainable.</p>
<ul>
<li>Define a named function</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="kt">def</span><span class="w"> </span><span class="nf">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">sample_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="cm">/* code hidden for brevity */</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">fastq_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">file_path</span><span class="o">)</span>
<a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">fastq_path</span><span class="o">.</span><span class="na">name</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="s">/^(.+)_S(\d+)_L(\d{3})_(R[12])_(\d{3})\.fastq(?:\.gz)?$/</span><span class="o">)</span>
<a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="cm">/* code hidden for brevity */</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">[:]</span>
<a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample_meta</span><span class="o">.</span><span class="na">quality</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a>
<a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">tuple</span><span class="o">(</span><span class="n">sample_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">file_meta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="nl">priority:</span><span class="w"> </span><span class="n">priority</span><span class="o">],</span><span class="w"> </span><span class="n">fastq_path</span><span class="o">)</span>
<a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="o">}</span>
</code></pre></div>
<ul>
<li>Call the named function in a workflow</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="n">workflow</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="w">    </span><span class="n">ch_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="o">.</span><span class="na">fromPath</span><span class="o">(</span><span class="s2">&quot;./data/samples.csv&quot;</span><span class="o">)</span>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="w">        </span><span class="o">.</span><span class="na">splitCsv</span><span class="o">(</span><span class="nl">header:</span><span class="w"> </span><span class="kc">true</span><span class="o">)</span>
<a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="w">        </span><span class="o">.</span><span class="na">map</span><span class="o">{</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">separateMetadata</span><span class="o">(</span><span class="n">row</span><span class="o">)</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a>
<a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a><span class="w">    </span><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">ch_samples</span><span class="o">)</span>
<a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="o">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Dynamic Resource Directives with Closures</strong>: You explored using closures in process directives for adaptive resource allocation based on input characteristics.</p>
<ul>
<li>Named closures and composition</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">enrichData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalizeId</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">addQualityCategory</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">addFlags</span>
<a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="kt">def</span><span class="w"> </span><span class="n">processor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generalFunction</span><span class="o">.</span><span class="na">curry</span><span class="o">(</span><span class="n">fixedParam</span><span class="o">)</span>
</code></pre></div>
<ul>
<li>Closures with scope access</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">collectStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">stats</span><span class="o">.</span><span class="na">count</span><span class="o">++;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Conditional Logic and Process Control</strong>: You added intelligent routing using <code>.branch()</code> and <code>.filter()</code> operators, leveraging truthiness for concise conditional expressions.</p>
<ul>
<li>Use <code>.branch()</code> to route data through different workflow branches</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="n">trim_branches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_samples</span>
<a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="o">.</span><span class="na">branch</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">,</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="w">    </span><span class="nl">fastp:</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;human&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">30000000</span>
<a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a><span class="w">    </span><span class="nl">trimgalore:</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="o">}</span>
<a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a>
<a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="n">ch_fastp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FASTP</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">fastp</span><span class="o">)</span>
<a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="n">ch_trimgalore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRIMGALORE</span><span class="o">(</span><span class="n">trim_branches</span><span class="o">.</span><span class="na">trimgalore</span><span class="o">)</span>
</code></pre></div>
<ul>
<li>Boolean evaluation with Groovy Truth</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">sample</span><span class="o">.</span><span class="na">files</span><span class="o">)</span><span class="w"> </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Has files&quot;</span>
</code></pre></div>
<ul>
<li>Use <code>filter()</code> to subset data with 'truthiness'</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="n">ch_valid_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch_samples</span>
<a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="w">    </span><span class="o">.</span><span class="na">filter</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">meta</span><span class="o">,</span><span class="w"> </span><span class="n">reads</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="w">        </span><span class="n">meta</span><span class="o">.</span><span class="na">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">organism</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="na">depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">25000000</span>
<a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="w">    </span><span class="o">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Safe Navigation and Elvis Operators</strong>: You made the pipeline robust against missing data using <code>?.</code> for null-safe property access and <code>?:</code> for providing default values.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="kt">def</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">?.</span><span class="na">sample</span><span class="o">?.</span><span class="na">id</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span>
</code></pre></div>
</li>
<li>
<p><strong>Validation with error() and log.warn</strong>: You learned to validate inputs early and fail fast with clear error messages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="k">try</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validateSample</span><span class="o">(</span><span class="n">sample</span><span class="o">)</span>
<a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">errors</span><span class="o">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="o">(</span><span class="s2">&quot;Invalid: ${errors.join(&#39;, &#39;)}&quot;</span><span class="o">)</span>
<a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="o">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="o">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Error: ${e.message}&quot;</span>
<a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a><span class="o">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Configuration Event Handlers</strong>: You learned to use workflow event handlers (<code>onComplete</code> and <code>onError</code>) for logging, notifications, and lifecycle management.</p>
<ul>
<li>Using <code>onComplete</code> to log and notify</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="n">workflow</span><span class="o">.</span><span class="na">onComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Success     : ${workflow.success}&quot;</span>
<a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;exit status : ${workflow.exitStatus}&quot;</span>
<a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a>
<a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="n">workflow</span><span class="o">.</span><span class="na">success</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;✅ Pipeline completed successfully!&quot;</span>
<a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;❌ Pipeline failed!&quot;</span>
<a id="__codelineno-138-9" name="__codelineno-138-9" href="#__codelineno-138-9"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Error: ${workflow.errorMessage}&quot;</span>
<a id="__codelineno-138-10" name="__codelineno-138-10" href="#__codelineno-138-10"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-138-11" name="__codelineno-138-11" href="#__codelineno-138-11"></a><span class="o">}</span>
</code></pre></div>
<ul>
<li>Using <code>onError</code> to take action specifically in case of failure</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="n">workflow</span><span class="o">.</span><span class="na">onError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="w">    </span><span class="c1">// Write detailed error log</span>
<a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="w">    </span><span class="kt">def</span><span class="w"> </span><span class="n">error_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">(</span><span class="s2">&quot;${workflow.launchDir}/error.log&quot;</span><span class="o">)</span>
<a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="w">    </span><span class="n">error_file</span><span class="o">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="s2">    Time: ${new Date()}</span>
<a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="s2">    Error: ${workflow.errorMessage}</span>
<a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="s2">    Error report: ${workflow.errorReport ?: &#39;No detailed report available&#39;}</span>
<a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a>
<a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="s2">&quot;Error details written to: ${error_file}&quot;</span>
<a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a><span class="o">}</span>
</code></pre></div>
</li>
</ol>
<h3 id="additional-resources">Additional resources<a class="headerlink" href="#additional-resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://nextflow.io/docs/latest/reference/syntax.html">Nextflow Language Reference</a></li>
<li><a href="https://www.nextflow.io/docs/latest/operator.html">Nextflow Operators</a></li>
<li><a href="https://www.nextflow.io/docs/latest/script.html">Nextflow Script Syntax</a></li>
<li><a href="https://nextflow.io/docs/latest/reference/stdlib.html">Nextflow Standard Library</a></li>
</ul>
<p>Be sure to check out these resources when you need to explore more advanced features.</p>
<p>You'll benefit from practicing and expanding your skills in order to:</p>
<ul>
<li>Write cleaner workflows with proper separation between dataflow and scripting</li>
<li>Master variable interpolation to avoid common pitfalls with Nextflow, Bash, and shell variables</li>
<li>Use dynamic resource directives for efficient, adaptive workflows</li>
<li>Transform file collections into properly formatted command-line arguments</li>
<li>Handle different file naming conventions and input formats gracefully using regex and string processing</li>
<li>Build reusable, maintainable code using advanced closure patterns and functional programming</li>
<li>Process and organize complex datasets using collection operations</li>
<li>Add validation, error handling, and logging to make your workflows production-ready</li>
<li>Implement workflow lifecycle management with event handlers</li>
</ul>
<hr />
<h2 id="whats-next">What's next?<a class="headerlink" href="#whats-next" title="Permanent link">&para;</a></h2>
<p>Return to the <a href="../">menu of Side Quests</a> or click the button in the bottom right of the page to move on to the next topic in the list.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Voltar ao topo
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Rodapé" >
        
          
          <a href="../debugging/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Debugging Workflows">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                Debugging Workflows
              </div>
            </div>
          </a>
        
        
          
          <a href="../nf-test/" class="md-footer__link md-footer__link--next" aria-label="Próximo: Testing with nf-test">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Próximo
              </span>
              <div class="md-ellipsis">
                Testing with nf-test
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  <div>
    Copyright &copy; 2020-2025,
    <a href="https://seqera.io" target="_blank" rel="noopener">Seqera</a>.
  </div>
  <div class="footer_cc_link">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
      <!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.-->
      <path
        d="m245.83 214.87-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93-22.13 0-33.22 14.61-33.22 43.84 0 23.57 9.21 43.84 33.22 43.84 14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98-22.6 0-73.96-10.32-73.96-77.05 0-58.69 43-77.06 72.63-77.06 30.72-.01 52.7 11.95 65.99 35.86zm143.05 0-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93-22.14 0-33.22 14.61-33.22 43.84 0 23.55 9.23 43.84 33.22 43.84 14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98-22.69 0-73.96-9.87-73.96-77.05 0-58.67 42.97-77.06 72.63-77.06 30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248 129.93 0 248.44-100.87 248.44-248 0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81 0-105.42 85.43-203.27 203.72-203.27 112.53 0 202.82 89.46 202.82 203.26-.01 121.69-99.68 202.82-202.84 202.82z"
      ></path>
    </svg>
    <a
      href="https://creativecommons.org/licenses/by-nc-nd/4.0/"
      target="_blank"
      rel="noopener"
      title="Creative Commons CC BY-NC-ND 4.0"
    >
      Creative Commons BY-NC-ND 4.0</a
    >.
  </div>
   Made with
  <a
    href="https://squidfunk.github.io/mkdocs-material/"
    target="_blank"
    rel="noopener"
  >
    Material for MkDocs
  </a>
  
</div>
      
        <div class="md-social">
  <a
    href="https://seqera.io"
    target="_blank"
    rel="noopener"
    class="footer_seqera_logo"
  >
    <img src="/assets/img/seqera_logo_white.png" />
  </a>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our training materials better. Find out more on <a href="https://seqera.io/privacy-policy/#cookies" target="_blank" rel="noopener">how we use cookies</a>.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="posthog" checked>
      <span class="task-list-indicator"></span>
      PostHog Analytics
    </label>
  </li>

      
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceitar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gerir configurações</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.action.edit", "content.code.annotate", "content.code.copy", "navigation.footer", "navigation.instant", "navigation.top", "navigation.tracking", "search.share", "toc.follow"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "search.result.more.one": "Mais 1 nesta p\u00e1gina", "search.result.more.other": "Mais # nesta p\u00e1gina", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.placeholder": "Digite para iniciar a busca", "search.result.term.missing": "Ausente", "select.version": "Selecione a vers\u00e3o"}, "version": {"alias": true, "provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../assets/javascripts/posthog.js"></script>
      
    
  </body>
</html>